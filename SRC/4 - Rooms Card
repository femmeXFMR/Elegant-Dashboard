## Room Summary Cards – Full Set (All Rooms)
#
# This file defines the complete set of glassmorphic Room Summary Cards for the entire home:
#
# - Lounge
# - Hallway
# - Kitchen / Dining / Living
# - WC
# - Garage
# - Stairs to Foyer / Landing
# - Master Bedroom (with inline Somfy blind controls)
# - Ensuite
# - Room 2 (with inline Somfy blind controls)
# - Room 3 (with inline Somfy blind controls)
# - Room 4 (with inline Somfy blind controls)
# - Study (with inline Somfy blind controls)
# - Washroom
#
# Each card includes:
# - Presence detection (FP2 or proxy source)
# - Temperature & climate indicators
# - Automation toggles
# - Light controls and grouped light actions
# - Fan controls (where applicable)
# - Door sensors (WC, Ensuite, Washroom)
# - Expandable inline Somfy blind controls (Lounge, Rooms 2–4, Master, Study)
#
# ——————————————————————————————————————————
# REQUIRED ENTITIES (grouped by area)
# ——————————————————————————————————————————
#
# Lounge
#   Presence:
#     - binary_sensor.lounge_fp2_presence
#   Temperature / Climate:
#     - climate.lounge_thermostat
#     - sensor.lounge_current_temperature
#   Automation:
#     - input_boolean.lounge_light_control
#   Lights:
#     - binary_sensor.lounge_any_light_on
#     - script.lounge_toggle_all_lights
#   Fan:
#     - fan.kitchen_fan
#   Blinds:
#     - cover.lounge_shutter
#     - input_boolean.lounge_blinds_expanded
#     - input_boolean.lounge_blinds_collapsed
#     - input_select.lounge_blinds_last_command
#     - script.lounge_blinds_boolean_toggle
#     - script.control_blinds
#
# Hallway
#   Presence:
#     - binary_sensor.presence_sensor_fp2_b046_presence_sensor_1
#   Temperature / Climate:
#     - climate.hallway_thermostat
#     - sensor.hallway_current_temperature
#   Automation:
#     - input_boolean.upstairs_stairway_and_hallway_light_automation
#   Lights:
#     - light.hallway_lights
#
# Kitchen / Dining / Living
#   Presence:
#     - binary_sensor.kitchen_dining_living_fp2_overallpresence
#   Temperature / Climate:
#     - climate.kitchen_thermostat
#     - sensor.kitchen_current_temperature
#   Automation:
#     - input_boolean.kitchen_automation
#   Lights:
#     - binary_sensor.kitchen_any_light_on
#     - script.kitchen_toggle_all_lights
#   Fan:
#     - fan.kitchen_fan
#
# WC
#   Presence:
#     - binary_sensor.wc_motion_sensor_2
#   Temperature / Climate:
#     - climate.wc_thermostat
#     - sensor.wc_current_temperature
#   Automation:
#     - input_boolean.wc_automation
#   Lights:
#     - light.wc_light
#   Door:
#     - binary_sensor.wc_door_sensor1
#
# Garage
#   Automation:
#     - input_boolean.garage_automation
#   Lights:
#     - light.garage_light
#
# Stairs to Foyer / Landing
#   Presence:
#     - binary_sensor.upstairs_fp2_overallpresence
#   Automation:
#     - input_boolean.upstairs_stairway_and_hallway_light_automation
#   Lights:
#     - switch.smart_switch_2211283432205855080548e1e9b1820f_outlet
#     - light.stairway_light
#
# Master Bedroom
#   Presence:
#     - binary_sensor.master_bedroom_fp2_presence_sensor_1
#   Temperature / Climate:
#     - sensor.linknlink_e04b41006845_temperature
#   Automation:
#     - input_boolean.master_bedroom_automation
#   Lights:
#     - binary_sensor.master_bedroom_any_light_on
#     - script.master_bedroom_toggle_all_lights
#   Fan:
#     - input_boolean.master_bedroom
#   Blinds:
#     - cover.master_bedroom_shutter
#     - input_boolean.master_bedroom_blinds_expanded
#     - input_boolean.master_bedroom_blinds_collapsed
#     - input_select.master_bedroom_blinds_last_command
#     - script.master_bedroom_blinds_boolean_toggle
#     - script.control_blinds
#
# Ensuite
#   Presence:
#     - binary_sensor.ensuite_presence
#   Temperature / Climate:
#     - climate.ensuite_thermostat
#     - sensor.ensuite_current_temperature
#   Automation:
#     - input_boolean.ensuite_automation
#   Lights:
#     - light.ensuite_light
#   Door:
#     - binary_sensor.ensuite_door_sensor
#
# Room 2
#   Presence:
#     - binary_sensor.room_2_presence
#   Temperature / Climate:
#     - climate.room_2_thermostat
#     - sensor.room_2_current_temperature
#   Automation:
#     - input_boolean.room_2_automation
#   Lights:
#     - binary_sensor.room_2_any_light_on
#     - script.room_2_toggle_all_lights
#     - light.room2_light
#   Blinds:
#     - cover.room_2_shutter
#     - input_boolean.room_2_blinds_expanded
#     - input_boolean.room_2_blinds_collapsed
#     - input_select.room_2_blinds_last_command
#     - script.room_2_blinds_boolean_toggle
#     - script.control_blinds
#
# Room 3
#   Presence:
#     - binary_sensor.room_3_presence
#   Temperature / Climate:
#     - climate.room_3_thermostat
#     - sensor.room_3_current_temperature
#   Automation:
#     - input_boolean.room_3_automation
#   Lights:
#     - light.room3_light
#   Fan:
#     - fan.room_3_fan
#   Blinds:
#     - cover.room_3_shutter
#     - input_boolean.room_3_blinds_expanded
#     - input_boolean.room_3_blinds_collapsed
#     - input_select.room_3_blinds_last_command
#     - script.room_3_blinds_boolean_toggle
#     - script.control_blinds
#
# Room 4
#   Presence:
#     - light.room_4_light
#   Temperature / Climate:
#     - climate.room_4_thermostat
#     - sensor.room_4_current_temperature
#   Automation:
#     - input_boolean.room_4_automation
#   Lights:
#     - light.room_4_light
#   Fan:
#     - fan.room_3_fan
#   Blinds:
#     - cover.room_4_shutter
#     - input_boolean.room_4_blinds_expanded
#     - input_boolean.room_4_blinds_collapsed
#     - input_select.room_4_blinds_last_command
#     - script.room_4_blinds_boolean_toggle
#     - script.control_blinds
#
# Study
#   Presence:
#     - binary_sensor.study_fp2_presence_sensor_2
#   Temperature / Climate:
#     - climate.study_thermostat
#     - sensor.study_current_temperature
#   Automation:
#     - input_boolean.study_automation
#   Lights:
#     - binary_sensor.study_any_light_on
#     - script.study_toggle_all_lights
#   Fan:
#     - fan.study_fan
#   Blinds:
#     - cover.study_shutter
#     - input_boolean.study_blinds_expanded
#     - input_boolean.study_blinds_collapsed
#     - input_select.study_blinds_last_command
#     - script.study_blinds_boolean_toggle
#     - script.control_blinds
#
# Washroom
#   Presence:
#     - binary_sensor.washroom_presence
#   Temperature / Climate:
#     - climate.washroom_thermostat
#     - sensor.washroom_current_temperature
#   Automation:
#     - input_boolean.washroom_automation
#   Lights:
#     - light.washroom_light
#   Door:
#     - binary_sensor.contact_sensor
#
# ——————————————————————————————————————————
# DEPENDENCIES
# ——————————————————————————————————————————
#   - custom:button-card
#   - custom:stack-in-card
#   - custom:card-mod
#
#   Scripts referenced:
#     - script.control_blinds
#     - script.*_toggle_all_lights
#     - script.*_blinds_boolean_toggle
#     - script.control_blinds
#     - script.master_bedroom_toggle_all_lights
#     - script.master_bedroom_blinds_boolean_toggle
#     - script.room_2_toggle_all_lights
#     - script.room_2_blinds_boolean_toggle
#     - script.room_3_blinds_boolean_toggle
#     - script.room_4_blinds_boolean_toggle
#     - script.study_toggle_all_lights
#     - script.study_blinds_boolean_toggle



type: custom:stack-in-card
mode: vertical
title: ""
card_mod:
  style: |
    ha-card {
      background: linear-gradient(235deg, rgba(131, 63, 102, 0.55), rgba(113, 72, 128, 0.25));
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); /* Subtle shadow for depth */
      backdrop-filter: blur(10px); /* The core glassmorphism blur effect */
      -webkit-backdrop-filter: blur(10px); /* Safari compatibility */
      border-radius: 24px; /* Rounded corners for the outer card */
      border: 1px solid rgba(255, 255, 255, 0.18); /* Light border */
      padding: 8px; /* Inner padding for content */
      color: var(--primary-text-color); /* Ensures text color is readable */
      --card-background-color: transparent; /* Makes the default card background transparent */
    }
cards:
  - type: vertical-stack
    cards:
      - type: conditional
        conditions:
          - entity: input_boolean.lounge_blinds_expanded
            state: "off"
        card:
          type: custom:button-card
          entity: binary_sensor.lounge_fp2_presence
          name: Lounge
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg bg\" \"i n temp automation light fan blinds\""
              - grid-template-columns: 48px 1fr 56px 36px 36px 36px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[
                const isOn = entity.state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(0, 200, 0, 0.25), rgba(50, 0, 0, 0.15))'
                  : 'rgba(255, 255, 255, 0.01)';  // less opaque, more transparent
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(91, 245, 178, 0.4)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(91, 245, 178, 0.4)';
                return `
                  <div style="
                    position: absolute;
                    top: 0; left: 0; right: 0; bottom: 0;
                    z-index: -1;
                    background: ${background};
                    border-radius: 40px;
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    box-shadow: ${boxShadow};
                  "></div>
                `;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#11f58e' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(7, 138, 79, 0.9), rgba(255, 89, 0, 0.1))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="
                    padding-top: 8px;
                    padding-bottom: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                  ">
                    <div style="
                      width: 36px;
                      height: 36px;
                      border-radius: 50%;
                      background: ${circleBackground};
                      box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px
                            rgba(91, 245, 178,0.4), inset -1px -1px 2px rgba(91, 245, 178,0.9);
                      backdrop-filter: blur(6px);
                      -webkit-backdrop-filter: blur(6px);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin-left: 6px;
                      z-index: 1;
                    ">
                      <ha-icon icon="mdi:sofa" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            temp:
              card:
                type: custom:button-card
                entity: climate.lounge_thermostat
                show_name: false
                show_icon: false
                show_state: false
                tap_action:
                  action: more-info
                styles:
                  card:
                    - padding: 4px 10px 4px 0px
                    - border-radius: 999px
                    - display: block
                    - font-weight: 600
                    - font-size: 0.7em
                    - text-align: center
                    - overflow: visible
                    - background: |
                        [[[
                          const hvac = states['climate.lounge_thermostat']?.attributes?.hvac_action;
                          return hvac === 'heating'
                            ? 'radial-gradient(circle at 30% 30%, rgba(250, 74, 35, 0.15), rgba(250, 74, 35, 0.05))'
                            : 'rgba(255, 255, 255, 0.08)';
                        ]]]
                    - box-shadow: |
                        [[[
                          const hvac = states['climate.lounge_thermostat']?.attributes?.hvac_action;
                          return hvac === 'heating'
                            ? '0 0 10px 1px rgba(250, 74, 35, 0.6), inset 1px 1px 2px rgba(250, 74, 35,0.9), inset -1px -1px 2px rgba(250, 74, 35,0.2)'
                            : 'none';
                        ]]]
                custom_fields:
                  value: |
                    [[[
                      const temp = parseFloat(states['sensor.lounge_current_temperature']?.state);
                      if (isNaN(temp)) return '';
                      const hvac = states['climate.lounge_thermostat']?.attributes?.hvac_action;
                      const iconColor = hvac === 'heating' ? '#fa4a23' : 'white';

                      let textColor = 'white';
                      if (temp < 20) textColor = '#63d8ff';    // Blue
                      else if (temp > 24) textColor = '#fa783c'; // Red

                      return `
                        <div style="
                          display: inline-flex;
                          align-items: center;
                          justify-content: center;
                          gap: 0px;
                          line-height: 1;
                          transform: translateX(1px);
                        ">
                          <ha-icon icon="mdi:thermometer" style="width: 15px; height: 15px; color: ${iconColor};"></ha-icon>
                          <span style="color: ${textColor};">${temp.toFixed(1)}</span>
                        </div>
                      `;
                    ]]]
                  animate: |
                    [[[
                      if (states['input_boolean.lounge_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.2s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            automation:
              card:
                type: custom:button-card
                entity: input_boolean.lounge_light_control
                show_name: false
                icon: mdi:robot-outline
                show_state: false
                tap_action:
                  action: toggle
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                            0.15), rgba(10, 255, 67, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px
                            2px rgba(10, 255, 67,0.9), inset -1px -1px 2px
                            rgba(10, 255, 67,0.2)
                      icon:
                        - color: "#0aff43"
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.lounge_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.15s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            light:
              card:
                type: custom:button-card
                entity: binary_sensor.lounge_any_light_on
                tap_action:
                  action: call-service
                  service: script.lounge_toggle_all_lights
                show_name: false
                icon: mdi:lightbulb-on-outline
                show_state: false
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(255, 243,
                            10, 0.15), rgba(255, 243, 10, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(255, 243, 10, 0.6), inset 1px 1px
                            2px rgba(255, 243, 10,0.9), inset -1px -1px 2px
                            rgba(255, 243, 10,0.2)
                      icon:
                        - color: gold
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.lounge_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.1s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            fan:
              card:
                type: custom:button-card
                entity: input_boolean.lounge_fan_power_button
                show_name: false
                icon: mdi:fan
                show_state: false
                tap_action:
                  action: toggle
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(2, 242, 250,
                            0.15), rgba(2, 242, 250, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(2, 242, 250, 0.6), inset 1px 1px
                            2px rgba(2, 242, 250,0.9), inset -1px -1px 2px
                            rgba(2, 242, 250,0.2)
                      icon:
                        - color: "#02f2fa"
                        - animation: rotation 1s linear infinite
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.lounge_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.05s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
                extra_styles: |
                  @keyframes rotation {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                  }
            blinds:
              card:
                type: custom:button-card
                icon: |
                  [[[
                    const expanded = states['input_boolean.lounge_blinds_expanded']?.state === 'on';
                    if (expanded) return 'mdi:close';

                    const last = states['input_select.lounge_blinds_last_command']?.state;
                    if (last === 'open') return 'mdi:window-shutter-open';
                    if (last === 'close') return 'mdi:window-shutter';
                    if (last === 'my') return 'mdi:blinds-horizontal-closed';
                    if (last === 'stop') return 'mdi:window-shutter-alert';
                    return 'mdi:blinds-horizontal';
                  ]]]
                size: 45%
                show_state: false
                show_name: false
                tap_action:
                  action: call-service
                  service: input_boolean.toggle
                  service_data:
                    entity_id: input_boolean.lounge_blinds_expanded
                styles:
                  card:
                    - border-radius: 50%
                    - width: 32px
                    - height: 32px
                    - background: |
                        [[[
                          const last = states['input_select.lounge_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return 'radial-gradient(circle at 30% 30%, rgba(240, 138, 60, 0.15), rgba(240, 138, 60, 0.05))';
                          return 'linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0, 0, 0.08))';
                        ]]]
                    - box-shadow: |
                        [[[
                          const last = states['input_select.lounge_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return '0 0 10px 1px rgba(255, 98, 13, 0.6), inset 1px 1px 2px rgba(255, 98, 13, 0.9), inset -1px -1px 2px rgba(240, 138, 60, 0.2)';
                          return 'inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px rgba(0,0,0,0.1)';
                        ]]]
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                    - color: |
                        [[[
                          const expanded = states['input_boolean.lounge_blinds_expanded']?.state === 'on';
                          if (expanded) return 'white';

                          const last = states['input_select.lounge_blinds_last_command']?.state;
                          if (last === 'open') return '#f08a3c';
                          if (last === 'close') return 'black';
                          if (last === 'stop') return '#f08a3c';
                          if (last === 'my') return '#f08a3c';
                          return '#f0c000';
                        ]]]
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.lounge_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
          extra_styles: |
            @keyframes pulse {
              0% { box-shadow: 0 0 0px rgba(255,136,77,0.6); }
              50% { box-shadow: 0 0 12px rgba(255,136,77,1); }
              100% { box-shadow: 0 0 0px rgba(255,136,77,0.6); }
            }
      - type: conditional
        conditions:
          - entity: input_boolean.lounge_blinds_expanded
            state: "on"
        card:
          type: custom:button-card
          entity: binary_sensor.lounge_fp2_presence
          name: Lounge
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg bg\" \"i n up pause down my close\""
              - grid-template-columns: 48px 1fr 30px 30px 30px 30px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[
                const isOn = entity.state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(0, 200, 0, 0.25), rgba(50, 0, 0, 0.15))'
                  : 'rgba(255, 255, 255, 0.01)';  // less opaque, more transparent
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(91, 245, 178, 0.4)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(91, 245, 178, 0.4)';
                return `
                  <div style="
                    position: absolute;
                    top: 0; left: 0; right: 0; bottom: 0;
                    z-index: -1;
                    background: ${background};
                    border-radius: 40px;
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    box-shadow: ${boxShadow};
                  "></div>
                `;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#11f58e' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(7, 138, 79, 0.9), rgba(255, 89, 0, 0.1))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="
                    padding-top: 8px;
                    padding-bottom: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                  ">
                    <div style="
                      width: 36px;
                      height: 36px;
                      border-radius: 50%;
                      background: ${circleBackground};
                      box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px
                            rgba(91, 245, 178,0.4), inset -1px -1px 2px rgba(91, 245, 178,0.9);
                      backdrop-filter: blur(6px);
                      -webkit-backdrop-filter: blur(6px);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin-left: 6px;
                      z-index: 1;
                    ">
                      <ha-icon icon="mdi:sofa" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            up:
              card:
                type: custom:button-card
                icon: mdi:arrow-up-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.lounge_shutter
                    command: open
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.2s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.6); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            pause:
              card:
                type: custom:button-card
                icon: mdi:pause
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.lounge_shutter
                    command: stop
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.15s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.5); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            down:
              card:
                type: custom:button-card
                icon: mdi:arrow-down-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.lounge_shutter
                    command: close
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.1s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.4); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            my:
              card:
                type: custom:button-card
                icon: mdi:star
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.lounge_shutter
                    command: my
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.05s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.3); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            close:
              card:
                type: custom:button-card
                icon: mdi:close-circle-outline
                tap_action:
                  action: call-service
                  service: script.lounge_blinds_boolean_toggle
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.2); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
  - type: custom:button-card
    entity: binary_sensor.presence_sensor_fp2_b046_presence_sensor_1
    name: Hallway
    show_state: false
    show_name: true
    layout: custom
    styles:
      card:
        - position: relative
        - height: 48px
        - margin: 0
        - padding: 0 2px
        - display: flex
        - align-items: center
        - justify-content: space-between
        - border-radius: 40px
        - overflow: visible
      grid:
        - grid-template-areas: "\"bg bg bg bg bg\" \"i n temp automation light\""
        - grid-template-columns: 48px 1fr 56px 36px 36px
        - column-gap: 4px
      name:
        - justify-self: start
        - font-size: 0.9em
        - font-weight: bold
      icon:
        - display: none
    custom_fields:
      bg: |
        [[[
          const isOn = entity.state === 'on';
          const background = isOn
            ? 'linear-gradient(135deg, rgba(255, 200, 0, 0.25), rgba(120, 80, 10, 0.15))'
            : 'rgba(255, 255, 255, 0.01)';
          const boxShadow = isOn
            ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(255, 215, 100, 0.4)'
            : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(255, 215, 100, 0.3)';
          return `
            <div style="
              position: absolute;
              top: 0; left: 0; right: 0; bottom: 0;
              z-index: -1;
              background: ${background};
              border-radius: 40px;
              backdrop-filter: blur(8px);
              -webkit-backdrop-filter: blur(8px);
              box-shadow: ${boxShadow};
            "></div>
          `;
        ]]]
      i: |
        [[[
          const isPresent = entity.state === 'on';
          const iconColor = isPresent ? '#ffd700' : 'white';
          const circleBackground = isPresent
            ? 'linear-gradient(145deg, rgba(200, 150, 0, 0.9), rgba(0, 0, 0, 0.5))'
            : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
          return `
            <div style="
              padding-top: 8px;
              padding-bottom: 8px;
              display: flex;
              align-items: center;
              justify-content: flex-start;
            ">
              <div style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: ${circleBackground};
                box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px
                      rgba(255, 225, 100, 0.3), inset -1px -1px 2px rgba(255, 225, 100, 0.7);
                backdrop-filter: blur(6px);
                -webkit-backdrop-filter: blur(6px);
                display: flex;
                align-items: center;
                justify-content: center;
                margin-left: 6px;
                z-index: 1;
              ">
                <ha-icon icon="mdi:mirror-variant" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
              </div>
            </div>`;
        ]]]
      temp:
        card:
          type: custom:button-card
          entity: climate.hallway_thermostat
          show_name: false
          show_icon: false
          show_state: false
          tap_action:
            action: more-info
          styles:
            card:
              - padding: 4px 10px 4px 0px
              - border-radius: 999px
              - display: block
              - font-weight: 600
              - font-size: 0.7em
              - text-align: center
              - overflow: visible
              - background: |
                  [[[
                    const hvac = states['climate.hallway_thermostat']?.attributes?.hvac_action;
                    return hvac === 'heating'
                      ? 'radial-gradient(circle at 30% 30%, rgba(250, 74, 35, 0.15), rgba(250, 74, 35, 0.05))'
                      : 'rgba(255, 255, 255, 0.08)';
                  ]]]
              - box-shadow: |
                  [[[
                    const hvac = states['climate.hallway_thermostat']?.attributes?.hvac_action;
                    return hvac === 'heating'
                      ? '0 0 10px 1px rgba(250, 74, 35, 0.6), inset 1px 1px 2px rgba(250, 74, 35,0.9), inset -1px -1px 2px rgba(250, 74, 35,0.2)'
                      : 'none';
                  ]]]
          custom_fields:
            value: |
              [[[
                const temp = parseFloat(states['sensor.hallway_current_temperature']?.state);
                if (isNaN(temp)) return '';
                const hvac = states['climate.hallway_thermostat']?.attributes?.hvac_action;
                const iconColor = hvac === 'heating' ? '#fa4a23' : 'white';

                let textColor = 'white';
                if (temp < 20) textColor = '#63d8ff';     // Cool blue
                else if (temp > 24) textColor = '#fa783c'; // Warm red

                return `
                  <div style="
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0px;
                    line-height: 1;
                    transform: translateX(1px);
                  ">
                    <ha-icon icon="mdi:thermometer" style="width: 15px; height: 15px; color: ${iconColor};"></ha-icon>
                    <span style="color: ${textColor};">${temp.toFixed(1)}</span>
                  </div>
                `;
              ]]]
      automation:
        card:
          type: custom:button-card
          entity: input_boolean.upstairs_stairway_and_hallway_light_automation
          show_name: false
          icon: mdi:robot-outline
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                      0.15), rgba(10, 255, 67, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px 2px
                      rgba(10, 255, 67,0.9), inset -1px -1px 2px rgba(10, 255,
                      67,0.2)
                icon:
                  - color: "#0aff43"
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
      light:
        card:
          type: custom:button-card
          entity: light.hallway_lights
          show_name: false
          icon: mdi:lightbulb-on-outline
          show_state: false
          tap_action:
            action: toggle
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
              - color: black
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(255, 223, 10,
                      0.15), rgba(255, 223, 10, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(255, 223, 10, 0.6), inset 1px 1px 2px
                      rgba(255, 223, 10, 0.9), inset -1px -1px 2px rgba(255,
                      223, 10, 0.2)
                icon:
                  - color: gold
  - type: custom:button-card
    entity: binary_sensor.kitchen_dining_living_fp2_overallpresence
    name: Kitchen
    show_state: false
    show_name: true
    layout: custom
    styles:
      card:
        - position: relative
        - height: 48px
        - margin: 0
        - padding: 0 2px
        - display: flex
        - align-items: center
        - justify-content: space-between
        - border-radius: 40px
        - overflow: visible
      grid:
        - grid-template-areas: "\"bg bg bg bg bg bg\" \"i n temp automation light fan\""
        - grid-template-columns: 48px 1fr 56px 36px 36px 36px
        - column-gap: 4px
      name:
        - justify-self: start
        - font-size: 0.9em
        - font-weight: bold
      icon:
        - display: none
    custom_fields:
      bg: |
        [[[
          const isOn = entity.state === 'on';
          const background = isOn
            ? 'linear-gradient(135deg, rgba(85, 125, 255, 0.25), rgba(110, 0, 255, 0.15))'
            : 'rgba(255, 255, 255, 0.01)';
          const boxShadow = isOn
            ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(100, 200, 255, 0.4)'
            : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(100, 200, 255, 0.4)';
          return `
            <div style="
              position: absolute;
              top: 0; left: 0; right: 0; bottom: 0;
              z-index: -1;
              background: ${background};
              border-radius: 40px;
              backdrop-filter: blur(8px);
              -webkit-backdrop-filter: blur(8px);
              box-shadow: ${boxShadow};
            "></div>
          `;
        ]]]
      i: |
        [[[
          const isPresent = entity.state === 'on';
          const iconColor = isPresent ? '#84f1ff' : 'white';
          const circleBackground = isPresent
            ? 'linear-gradient(145deg, rgba(60, 168, 255, 0.9), rgba(255, 89, 0, 0.1))'
            : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
          return `
            <div style="
              padding-top: 8px;
              padding-bottom: 8px;
              display: flex;
              align-items: center;
              justify-content: flex-start;
            ">
              <div style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: ${circleBackground};
                box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px rgba(100, 200, 255,0.4), inset -1px -1px 2px rgba(100, 200, 255,0.9);
                backdrop-filter: blur(6px);
                -webkit-backdrop-filter: blur(6px);
                display: flex;
                align-items: center;
                justify-content: center;
                margin-left: 6px;
                z-index: 1;
              ">
                <ha-icon icon="mdi:silverware-fork-knife" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
              </div>
            </div>`;
        ]]]
      temp:
        card:
          type: custom:button-card
          entity: climate.kitchen_thermostat
          show_name: false
          show_icon: false
          show_state: false
          tap_action:
            action: more-info
          styles:
            card:
              - padding: 4px 10px 4px 0px
              - border-radius: 999px
              - display: block
              - font-weight: 600
              - font-size: 0.7em
              - text-align: center
              - overflow: visible
              - background: |
                  [[[
                    const hvac = states['climate.kitchen_thermostat']?.attributes?.hvac_action;
                    return hvac === 'heating'
                      ? 'radial-gradient(circle at 30% 30%, rgba(250, 74, 35, 0.15), rgba(250, 74, 35, 0.05))'
                      : 'rgba(255, 255, 255, 0.08)';
                  ]]]
              - box-shadow: |
                  [[[
                    const hvac = states['climate.kitchen_thermostat']?.attributes?.hvac_action;
                    return hvac === 'heating'
                      ? '0 0 10px 1px rgba(250, 74, 35, 0.6), inset 1px 1px 2px rgba(250, 74, 35,0.9), inset -1px -1px 2px rgba(250, 74, 35,0.2)'
                      : 'none';
                  ]]]
          custom_fields:
            value: |
              [[[
                const temp = parseFloat(states['sensor.kitchen_current_temperature']?.state);
                if (isNaN(temp)) return '';
                const hvac = states['climate.kitchen_thermostat']?.attributes?.hvac_action;
                const iconColor = hvac === 'heating' ? '#fa4a23' : 'white';

                let textColor = 'white';
                if (temp < 20) textColor = '#63d8ff';
                else if (temp > 24) textColor = '#fa783c';

                return `
                  <div style="
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0px;
                    line-height: 1;
                    transform: translateX(1px);
                  ">
                    <ha-icon icon="mdi:thermometer" style="width: 15px; height: 15px; color: ${iconColor};"></ha-icon>
                    <span style="color: ${textColor};">${temp.toFixed(1)}</span>
                  </div>
                `;
              ]]]
      automation:
        card:
          type: custom:button-card
          entity: input_boolean.kitchen_automation
          show_name: false
          icon: mdi:robot-outline
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                      0.15), rgba(10, 255, 67, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px 2px
                      rgba(10, 255, 67,0.9), inset -1px -1px 2px rgba(10, 255,
                      67,0.2)
                icon:
                  - color: "#0aff43"
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
      light:
        card:
          type: custom:button-card
          entity: binary_sensor.kitchen_any_light_on
          tap_action:
            action: call-service
            service: script.kitchen_toggle_all_lights
          show_name: false
          icon: mdi:lightbulb-on-outline
          show_state: false
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(255, 243, 10,
                      0.15), rgba(255, 243, 10, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(255, 243, 10, 0.6), inset 1px 1px 2px
                      rgba(255, 243, 10,0.9), inset -1px -1px 2px rgba(255, 243,
                      10,0.2)
                icon:
                  - color: gold
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
      fan:
        card:
          type: custom:button-card
          entity: fan.kitchen_fan
          show_name: false
          icon: mdi:fan
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(2, 242, 250,
                      0.15), rgba(2, 242, 250, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(2, 242, 250, 0.6), inset 1px 1px 2px
                      rgba(2, 242, 250,0.9), inset -1px -1px 2px rgba(2, 242,
                      250,0.2)
                icon:
                  - color: "#02f2fa"
                  - animation: rotation 1s linear infinite
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
          extra_styles: |
            @keyframes rotation {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
            }
    extra_styles: |
      @keyframes pulse {
        0% { box-shadow: 0 0 0px rgba(255,136,77,0.6); }
        50% { box-shadow: 0 0 12px rgba(255,136,77,1); }
        100% { box-shadow: 0 0 0px rgba(255,136,77,0.6); }
      }
  - type: custom:button-card
    entity: binary_sensor.wc_motion_sensor_2
    name: WC
    show_state: false
    show_name: true
    layout: custom
    styles:
      card:
        - position: relative
        - height: 48px
        - margin: 0
        - padding: 0 2px
        - display: flex
        - align-items: center
        - justify-content: space-between
        - border-radius: 40px
        - overflow: visible
      grid:
        - grid-template-areas: "\"bg bg bg bg bg bg\" \"i n temp automation light door\""
        - grid-template-columns: 48px 1fr 56px 36px 36px 36px
        - column-gap: 4px
      name:
        - justify-self: start
        - font-size: 0.9em
        - font-weight: bold
      icon:
        - display: none
    custom_fields:
      bg: |
        [[[
          const isOn = entity && entity.state === 'on';
          const background = isOn
            ? 'linear-gradient(135deg, rgba(255, 135, 80, 0.25), rgba(80, 0, 0, 0.15))'
            : 'rgba(255, 255, 255, 0.01)';
          const boxShadow = isOn
            ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(230, 130, 120, 0.4)'
            : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(230, 130, 120, 0.4)';
          return `
            <div style="
              position: absolute;
              top: 0; left: 0; right: 0; bottom: 0;
              z-index: -1;
              background: ${background};
              border-radius: 40px;
              backdrop-filter: blur(8px);
              -webkit-backdrop-filter: blur(8px);
              box-shadow: ${boxShadow};
            "></div>
          `;
        ]]]
      i: |
        [[[
          const isPresent = entity && entity.state === 'on';
          const iconColor = isPresent ? '#f79143' : 'white';
          const circleBackground = isPresent
            ? 'linear-gradient(145deg, rgba(247, 112, 67, 0.9), rgba(0, 0, 0, 0.6))'
            : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
          return `
            <div style="
              padding-top: 8px;
              padding-bottom: 8px;
              display: flex;
              align-items: center;
              justify-content: flex-start;
            ">
              <div style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: ${circleBackground};
                box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px rgba(230, 130, 120, 0.4), inset -1px -1px 2px rgba(230, 130, 120, 0.9);
                backdrop-filter: blur(6px);
                -webkit-backdrop-filter: blur(6px);
                display: flex;
                align-items: center;
                justify-content: center;
                margin-left: 6px;
                z-index: 1;
              ">
                <ha-icon icon="mdi:toilet" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
              </div>
            </div>`;
        ]]]
      temp:
        card:
          type: custom:button-card
          entity: climate.wc_thermostat
          show_name: false
          show_icon: false
          show_state: false
          tap_action:
            action: more-info
          styles:
            card:
              - padding: 4px 10px 4px 0px
              - border-radius: 999px
              - display: block
              - font-weight: 600
              - font-size: 0.7em
              - text-align: center
              - overflow: visible
              - background: |
                  [[[
                    const hvac = states['climate.wc_thermostat']?.attributes?.hvac_action;
                    return hvac === 'heating'
                      ? 'radial-gradient(circle at 30% 30%, rgba(250, 74, 35, 0.15), rgba(250, 74, 35, 0.05))'
                      : 'rgba(255, 255, 255, 0.08)';
                  ]]]
              - box-shadow: |
                  [[[
                    const hvac = states['climate.wc_thermostat']?.attributes?.hvac_action;
                    return hvac === 'heating'
                      ? '0 0 10px 1px rgba(250, 74, 35, 0.6), inset 1px 1px 2px rgba(250, 74, 35,0.9), inset -1px -1px 2px rgba(250, 74, 35,0.2)'
                      : 'none';
                  ]]]
          custom_fields:
            value: |
              [[[
                const temp = parseFloat(states['sensor.wc_current_temperature']?.state);
                if (isNaN(temp)) return '';
                const hvac = states['climate.wc_thermostat']?.attributes?.hvac_action;
                const iconColor = hvac === 'heating' ? '#fa4a23' : 'white';

                let textColor = 'white';
                if (temp < 20) textColor = '#63d8ff';
                else if (temp > 24) textColor = '#fa783c';

                return `
                  <div style="
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0px;
                    line-height: 1;
                    transform: translateX(1px);
                  ">
                    <ha-icon icon="mdi:thermometer" style="width: 15px; height: 15px; color: ${iconColor};"></ha-icon>
                    <span style="color: ${textColor};">${temp.toFixed(1)}</span>
                  </div>
                `;
              ]]]
      automation:
        card:
          type: custom:button-card
          entity: input_boolean.wc_automation
          show_name: false
          icon: mdi:robot-outline
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                      0.15), rgba(10, 255, 67, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px 2px
                      rgba(10, 255, 67,0.9), inset -1px -1px 2px rgba(10, 255,
                      67,0.2)
                icon:
                  - color: "#0aff43"
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
      light:
        card:
          type: custom:button-card
          entity: light.wc_light
          show_name: false
          icon: mdi:lightbulb-on-outline
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(255, 243, 10,
                      0.15), rgba(255, 243, 10, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(255, 243, 10, 0.6), inset 1px 1px 2px
                      rgba(255, 243, 10,0.9), inset -1px -1px 2px rgba(255, 243,
                      10,0.2)
                icon:
                  - color: gold
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
      door:
        card:
          type: custom:button-card
          entity: binary_sensor.wc_door_sensor1
          show_name: false
          icon: mdi:door-closed
          show_state: false
          tap_action:
            action: more-info
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(255, 80, 80,
                      0.15), rgba(255, 80, 80, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(255, 10, 75, 0.6), inset 1px 1px 2px
                      rgba(255, 10, 75,0.9), inset -1px -1px 2px rgba(255, 10,
                      75,0.2)
                icon:
                  - color: "#ff5050"
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255,255,255,0.12),
                  rgba(0,0,0,0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
  - type: custom:button-card
    entity: light.garage_light
    name: Garage
    show_state: false
    show_name: true
    layout: custom
    styles:
      card:
        - position: relative
        - height: 48px
        - margin: 0
        - padding: 0 2px
        - display: flex
        - align-items: center
        - justify-content: space-between
        - border-radius: 40px
        - overflow: visible
      grid:
        - grid-template-areas: "\"bg bg bg bg\" \"i n automation light\""
        - grid-template-columns: 48px 1fr 36px 36px
        - column-gap: 4px
      name:
        - justify-self: start
        - font-size: 0.9em
        - font-weight: bold
      icon:
        - display: none
    custom_fields:
      bg: |
        [[[
          const isOn = entity.state === 'on';
          const background = isOn
            ? 'linear-gradient(135deg, rgba(102, 153, 255, 0.25), rgba(30, 30, 60, 0.15))'
            : 'rgba(255, 255, 255, 0.01)';
          const boxShadow = isOn
            ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(102, 153, 255, 0.4)'
            : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(102, 153, 255, 0.3)';
          return `
            <div style="
              position: absolute;
              top: 0; left: 0; right: 0; bottom: 0;
              z-index: -1;
              background: ${background};
              border-radius: 40px;
              backdrop-filter: blur(8px);
              -webkit-backdrop-filter: blur(8px);
              box-shadow: ${boxShadow};
            "></div>
          `;
        ]]]
      i: |
        [[[
          const isOn = entity.state === 'on';
          const iconColor = isOn ? '#6699ff' : 'white';
          const circleBackground = isOn
            ? 'linear-gradient(145deg, rgba(102, 153, 255, 0.9), rgba(0, 0, 0, 0.3))'
            : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
          return `
            <div style="
              padding-top: 8px;
              padding-bottom: 8px;
              display: flex;
              align-items: center;
              justify-content: flex-start;
            ">
              <div style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: ${circleBackground};
                box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px rgba(102, 153, 255,0.4), inset -1px -1px 2px rgba(102, 153, 255,0.9);
                backdrop-filter: blur(6px);
                -webkit-backdrop-filter: blur(6px);
                display: flex;
                align-items: center;
                justify-content: center;
                margin-left: 6px;
                z-index: 1;
              ">
                <ha-icon icon="mdi:garage" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
              </div>
            </div>`;
        ]]]
      automation:
        card:
          type: custom:button-card
          entity: input_boolean.garage_automation
          icon: mdi:robot-outline
          show_name: false
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                      0.15), rgba(10, 255, 67, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px 2px
                      rgba(10, 255, 67,0.9), inset -1px -1px 2px rgba(10, 255,
                      67,0.2)
                icon:
                  - color: "#0aff43"
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            custom_fields:
              animate:
                - display: block
                - height: 0
                - overflow: hidden
                - visibility: hidden
            icon:
              - font-size: 1.3em
          custom_fields:
            animate: |
              [[[
                if (states['input_boolean.room_2_blinds_collapsed']?.state === 'on') {
                  return `<style>
                    @keyframes zoomReveal {
                      from { opacity: 0; transform: scale(0.7); }
                      to { opacity: 1; transform: scale(1); }
                    }
                    ha-card {
                      animation: zoomReveal 0.3s ease-out forwards;
                      animation-delay: 0.1s;
                      opacity: 0;
                    }
                  </style>`;
                }
                return '';
              ]]]
      light:
        card:
          type: custom:button-card
          entity: light.garage_light
          show_name: false
          icon: mdi:lightbulb-on-outline
          show_state: false
          tap_action:
            action: toggle
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
              - color: black
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(102, 153, 255,
                      0.15), rgba(102, 153, 255, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(102, 153, 255, 0.6), inset 1px 1px 2px
                      rgba(102, 153, 255, 0.9), inset -1px -1px 2px rgba(102,
                      153, 255, 0.2)
                icon:
                  - color: "#6699ff"
  - type: custom:button-card
    entity: binary_sensor.upstairs_fp2_overallpresence
    name: Stairs to Foyer
    show_state: false
    show_name: true
    layout: custom
    styles:
      card:
        - position: relative
        - height: 48px
        - margin: 0
        - padding: 0 2px
        - display: flex
        - align-items: center
        - justify-content: space-between
        - border-radius: 40px
        - overflow: visible
      grid:
        - grid-template-areas: "\"bg bg bg bg bg\" \"i n automation upstairslight stairwaylight\""
        - grid-template-columns: 48px 1fr 36px 36px 36px
        - column-gap: 4px
      name:
        - justify-self: start
        - font-size: 0.9em
        - font-weight: bold
      icon:
        - display: none
    custom_fields:
      bg: |
        [[[
          const isOn = entity.state === 'on';
          const background = isOn
            ? 'linear-gradient(135deg, rgba(230, 120, 255, 0.25), rgba(60, 0, 90, 0.15))'
            : 'rgba(255, 255, 255, 0.01)';
          const boxShadow = isOn
            ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(230, 120, 255, 0.4)'
            : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(230, 120, 255, 0.3)';
          return `
            <div style="
              position: absolute;
              top: 0; left: 0; right: 0; bottom: 0;
              z-index: -1;
              background: ${background};
              border-radius: 40px;
              backdrop-filter: blur(8px);
              -webkit-backdrop-filter: blur(8px);
              box-shadow: ${boxShadow};
            "></div>
          `;
        ]]]
      i: |
        [[[
          const isPresent = entity.state === 'on';
          const iconColor = isPresent ? '#f487ff' : 'white';
          const circleBackground = isPresent
            ? 'linear-gradient(145deg, rgba(230, 120, 255, 0.9), rgba(0, 0, 0, 0.3))'
            : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
          return `
            <div style="
              padding-top: 8px;
              padding-bottom: 8px;
              display: flex;
              align-items: center;
              justify-content: flex-start;
            ">
              <div style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: ${circleBackground};
                box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px rgba(230, 120, 255, 0.4), inset -1px -1px 2px rgba(230, 120, 255, 0.9);
                backdrop-filter: blur(6px);
                -webkit-backdrop-filter: blur(6px);
                display: flex;
                align-items: center;
                justify-content: center;
                margin-left: 6px;
                z-index: 1;
              ">
                <ha-icon icon="mdi:stairs-up" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
              </div>
            </div>`;
        ]]]
      automation:
        card:
          type: custom:button-card
          entity: input_boolean.upstairs_stairway_and_hallway_light_automation
          show_name: false
          icon: mdi:robot-outline
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                      0.15), rgba(10, 255, 67, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px 2px
                      rgba(10, 255, 67,0.9), inset -1px -1px 2px rgba(10, 255,
                      67,0.2)
                icon:
                  - color: "#0aff43"
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
      upstairslight:
        card:
          type: custom:button-card
          entity: switch.smart_switch_2211283432205855080548e1e9b1820f_outlet
          show_name: false
          icon: mdi:lightbulb-on-outline
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(255, 243, 10,
                      0.15), rgba(255, 243, 10, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(255, 243, 10, 0.6), inset 1px 1px 2px
                      rgba(255, 243, 10,0.9), inset -1px -1px 2px rgba(255, 243,
                      10,0.2)
                icon:
                  - color: gold
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
      stairwaylight:
        card:
          type: custom:button-card
          entity: light.stairway_light
          show_name: false
          icon: mdi:led-strip-variant
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(255, 243, 10,
                      0.15), rgba(255, 243, 10, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(255, 243, 10, 0.6), inset 1px 1px 2px
                      rgba(255, 243, 10,0.9), inset -1px -1px 2px rgba(255, 243,
                      10,0.2)
                icon:
                  - color: gold
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
  - type: vertical-stack
    cards:
      - type: conditional
        conditions:
          - entity: input_boolean.master_bedroom_blinds_expanded
            state: "off"
        card:
          type: custom:button-card
          entity: binary_sensor.master_bedroom_fp2_presence_sensor_1
          name: Master Bedroom
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg bg\" \"i n temp automation light fan blinds\""
              - grid-template-columns: 48px 1fr 56px 36px 36px 36px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[ 
                const isOn = entity.state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(250, 60, 136, 0.25), rgba(90, 60, 200, 0.15))'
                  : 'rgba(255, 255, 255, 0.01)';
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(250, 60, 136, 0.4)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(250, 60, 136, 0.4)';
                return `
                  <div style="
                    position: absolute;
                    top: 0; left: 0; right: 0; bottom: 0;
                    z-index: -1;
                    background: ${background};
                    border-radius: 40px;
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    box-shadow: ${boxShadow};
                  "></div>
                `;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#faacbf' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(252, 106, 143, 0.8), rgba(13, 5, 7, 0.4))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="
                    padding-top: 8px;
                    padding-bottom: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                  ">
                    <div style="
                      width: 36px;
                      height: 36px;
                      border-radius: 50%;
                      background: ${circleBackground};
                      box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px
                            rgba(245, 91, 153,0.4), inset -1px -1px 2px rgba(255, 107, 142,0.9);
                      backdrop-filter: blur(6px);
                      -webkit-backdrop-filter: blur(6px);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin-left: 6px;
                      z-index: 1;
                    ">
                      <ha-icon icon="mdi:bed-double" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            temp:
              card:
                type: custom:button-card
                entity: sensor.linknlink_e04b41006845_temperature
                show_name: false
                show_icon: false
                show_state: false
                tap_action:
                  action: more-info
                styles:
                  card:
                    - padding: 4px 10px 4px 0px
                    - border-radius: 999px
                    - display: block
                    - font-weight: 600
                    - font-size: 0.7em
                    - text-align: center
                    - overflow: visible
                    - background: rgba(255, 255, 255, 0.08)
                    - box-shadow: none
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                custom_fields:
                  value: >
                    [[[ const t =
                    parseFloat(states['sensor.linknlink_e04b41006845_temperature']?.state);
                    if (isNaN(t)) return ''; const c = t > 24 ? '#fa783c' : t <
                    20 ? '#63d8ff' : 'white'; return `<div style="display: flex;
                    align-items: center; justify-content: center;"><ha-icon
                    icon="mdi:thermometer" style="width: 15px; height: 15px;
                    color: white;"></ha-icon><span style="color:
                    ${c};">${t.toFixed(1)}</span></div>` ]]]
                  animate: |
                    [[[
                      if (states['input_boolean.master_bedroom_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.2s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            automation:
              card:
                type: custom:button-card
                entity: input_boolean.master_bedroom_automation
                icon: mdi:robot-outline
                show_name: false
                show_state: false
                tap_action:
                  action: toggle
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                            0.15), rgba(10, 255, 67, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px
                            2px rgba(10, 255, 67,0.9), inset -1px -1px 2px
                            rgba(10, 255, 67,0.2)
                      icon:
                        - color: "#0aff43"
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.master_bedroom_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.15s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            light:
              card:
                type: custom:button-card
                entity: binary_sensor.master_bedroom_any_light_on
                tap_action:
                  action: call-service
                  service: script.master_bedroom_toggle_all_lights
                icon: mdi:lightbulb-on-outline
                show_name: false
                show_state: false
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(255, 243,
                            10, 0.15), rgba(255, 243, 10, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(255, 243, 10, 0.6), inset 1px 1px
                            2px rgba(255, 243, 10,0.9), inset -1px -1px 2px
                            rgba(255, 243, 10,0.2)
                      icon:
                        - color: gold
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.master_bedroom_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.1s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            fan:
              card:
                type: custom:button-card
                entity: input_boolean.master_bedroom
                icon: mdi:fan
                show_name: false
                show_state: false
                tap_action:
                  action: toggle
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(2, 242, 250,
                            0.15), rgba(2, 242, 250, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(2, 242, 250, 0.6), inset 1px 1px
                            2px rgba(2, 242, 250,0.9), inset -1px -1px 2px
                            rgba(2, 242, 250,0.2)
                      icon:
                        - color: "#02f2fa"
                        - animation: rotation 1s linear infinite
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                extra_styles: |
                  @keyframes rotation {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                  }
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.master_bedroom_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.05s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            blinds:
              card:
                type: custom:button-card
                icon: |
                  [[[
                    const expanded = states['input_boolean.master_bedroom_blinds_expanded']?.state === 'on';
                    if (expanded) return 'mdi:close';

                    const last = states['input_select.master_bedroom_blinds_last_command']?.state;
                    if (last === 'open') return 'mdi:window-shutter-open';
                    if (last === 'close') return 'mdi:window-shutter';
                    if (last === 'my') return 'mdi:blinds-horizontal-closed';
                    if (last === 'stop') return 'mdi:window-shutter-alert';
                    return 'mdi:blinds-horizontal';
                  ]]]
                size: 45%
                show_state: false
                show_name: false
                tap_action:
                  action: call-service
                  service: input_boolean.toggle
                  service_data:
                    entity_id: input_boolean.master_bedroom_blinds_expanded
                styles:
                  card:
                    - border-radius: 50%
                    - width: 32px
                    - height: 32px
                    - background: |
                        [[[
                          const last = states['input_select.master_bedroom_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return 'radial-gradient(circle at 30% 30%, rgba(240, 138, 60, 0.15), rgba(240, 138, 60, 0.05))';
                          return 'linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0, 0, 0.08))';
                        ]]]
                    - box-shadow: |
                        [[[
                          const last = states['input_select.master_bedroom_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return '0 0 10px 1px rgba(255, 98, 13, 0.6), inset 1px 1px 2px rgba(255, 98, 13, 0.9), inset -1px -1px 2px rgba(240, 138, 60, 0.2)';
                          return 'inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px rgba(0,0,0,0.1)';
                        ]]]
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                    - color: |
                        [[[
                          const expanded = states['input_boolean.master_bedroom_blinds_expanded']?.state === 'on';
                          if (expanded) return 'white';

                          const last = states['input_select.master_bedroom_blinds_last_command']?.state;
                          if (last === 'open') return '#f08a3c';
                          if (last === 'close') return 'black';
                          if (last === 'stop') return '#f08a3c';
                          if (last === 'my') return '#f08a3c';
                          return '#f0c000';
                        ]]]
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.master_bedroom_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
          extra_styles: |
            @keyframes pulse {
              0% { box-shadow: 0 0 0px rgba(255,136,77,0.6); }
              50% { box-shadow: 0 0 12px rgba(255,136,77,1); }
              100% { box-shadow: 0 0 0px rgba(255,136,77,0.6); }
            }
      - type: conditional
        conditions:
          - entity: input_boolean.master_bedroom_blinds_expanded
            state: "on"
        card:
          type: custom:button-card
          entity: binary_sensor.master_bedroom_fp2_presence_sensor_1
          name: Master Bedroom
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg bg\" \"i n up pause down my close\""
              - grid-template-columns: 48px 1fr 30px 30px 30px 30px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[ 
                const isOn = entity.state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(250, 60, 136, 0.25), rgba(90, 60, 200, 0.15))'
                  : 'rgba(255, 255, 255, 0.01)';
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(250, 60, 136, 0.4)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(250, 60, 136, 0.4)';
                return `
                  <div style="
                    position: absolute;
                    top: 0; left: 0; right: 0; bottom: 0;
                    z-index: -1;
                    background: ${background};
                    border-radius: 40px;
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    box-shadow: ${boxShadow};
                  "></div>
                `;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#faacbf' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(252, 106, 143, 0.8), rgba(13, 5, 7, 0.4))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="
                    padding-top: 8px;
                    padding-bottom: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                  ">
                    <div style="
                      width: 36px;
                      height: 36px;
                      border-radius: 50%;
                      background: ${circleBackground};
                      box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px
                            rgba(245, 91, 153,0.4), inset -1px -1px 2px rgba(255, 107, 142,0.9);
                      backdrop-filter: blur(6px);
                      -webkit-backdrop-filter: blur(6px);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin-left: 6px;
                      z-index: 1;
                    ">
                      <ha-icon icon="mdi:bed-double" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            up:
              card:
                type: custom:button-card
                icon: mdi:arrow-up-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.master_bedroom_shutter
                    command: open
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.2s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.6); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            pause:
              card:
                type: custom:button-card
                icon: mdi:pause
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.master_bedroom_shutter
                    command: stop
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.15s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.5); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            down:
              card:
                type: custom:button-card
                icon: mdi:arrow-down-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.master_bedroom_shutter
                    command: close
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.1s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.4); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            my:
              card:
                type: custom:button-card
                icon: mdi:star
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.master_bedroom_shutter
                    command: my
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.05s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.3); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            close:
              card:
                type: custom:button-card
                icon: mdi:close-circle-outline
                tap_action:
                  action: call-service
                  service: script.master_bedroom_blinds_boolean_toggle
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.2); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
  - type: custom:button-card
    entity: binary_sensor.ensuite_presence
    name: Ensuite
    show_state: false
    show_name: true
    layout: custom
    styles:
      card:
        - position: relative
        - height: 48px
        - margin: 0
        - padding: 0 2px
        - display: flex
        - align-items: center
        - justify-content: space-between
        - border-radius: 40px
        - overflow: visible
      grid:
        - grid-template-areas: "\"bg bg bg bg bg bg\" \"i n temp automation light door\""
        - grid-template-columns: 48px 1fr 56px 36px 36px 36px
        - column-gap: 4px
      name:
        - justify-self: start
        - font-size: 0.9em
        - font-weight: bold
      icon:
        - display: none
    custom_fields:
      bg: |
        [[[ const isOn = entity && entity.state === 'on';
            const background = isOn ? 'linear-gradient(135deg, rgba(255, 135, 80, 0.25), rgba(80, 0, 0, 0.15))' : 'rgba(255, 255, 255, 0.01)';
            const boxShadow = isOn ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(230, 130, 120, 0.4)' : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(230, 130, 120, 0.4)';
            return `<div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: -1; background: ${background}; border-radius: 40px; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); box-shadow: ${boxShadow};"></div>`;
        ]]]
      i: |
        [[[ const isPresent = entity && entity.state === 'on';
            const iconColor = isPresent ? '#f79143' : 'white';
            const circleBackground = isPresent ? 'linear-gradient(145deg, rgba(247, 112, 67, 0.9), rgba(0, 0, 0, 0.6))' : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
            return `<div style="padding-top: 8px; padding-bottom: 8px; display: flex; align-items: center; justify-content: flex-start;"><div style="width: 36px; height: 36px; border-radius: 50%; background: ${circleBackground}; box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px rgba(230, 130, 120, 0.4), inset -1px -1px 2px rgba(230, 130, 120, 0.9); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); display: flex; align-items: center; justify-content: center; margin-left: 6px; z-index: 1;"><ha-icon icon="mdi:shower-head" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon></div></div>`;
        ]]]
      temp:
        card:
          type: custom:button-card
          entity: climate.ensuite_thermostat
          show_name: false
          show_icon: false
          show_state: false
          tap_action:
            action: more-info
          styles:
            card:
              - padding: 4px 10px 4px 0px
              - border-radius: 999px
              - display: block
              - font-weight: 600
              - font-size: 0.7em
              - text-align: center
              - overflow: visible
              - background: >
                  [[[ const hvac =
                  states['climate.ensuite_thermostat']?.attributes?.hvac_action;
                  return hvac === 'heating' ? 'radial-gradient(circle at 30%
                  30%, rgba(250, 74, 35, 0.15), rgba(250, 74, 35, 0.05))' :
                  'rgba(255, 255, 255, 0.08)'; ]]]
              - box-shadow: >
                  [[[ const hvac =
                  states['climate.ensuite_thermostat']?.attributes?.hvac_action;
                  return hvac === 'heating' ? '0 0 10px 1px rgba(250, 74, 35,
                  0.6), inset 1px 1px 2px rgba(250, 74, 35,0.9), inset -1px -1px
                  2px rgba(250, 74, 35,0.2)' : 'none'; ]]]
          custom_fields:
            value: >
              [[[ const temp =
              parseFloat(states['sensor.ensuite_current_temperature']?.state);
              if (isNaN(temp)) return ''; const hvac =
              states['climate.ensuite_thermostat']?.attributes?.hvac_action;
              const iconColor = hvac === 'heating' ? '#fa4a23' : 'white'; let
              textColor = 'white'; if (temp < 20) textColor = '#63d8ff'; else if
              (temp > 24) textColor = '#fa783c'; return `<div style="display:
              inline-flex; align-items: center; justify-content: center; gap:
              0px; line-height: 1; transform: translateX(1px);"><ha-icon
              icon="mdi:thermometer" style="width: 15px; height: 15px; color:
              ${iconColor};"></ha-icon><span style="color:
              ${textColor};">${temp.toFixed(1)}</span></div>`; ]]]
      automation:
        card:
          type: custom:button-card
          entity: input_boolean.ensuite_automation
          show_name: false
          icon: mdi:robot-outline
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                      0.15), rgba(10, 255, 67, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px 2px
                      rgba(10, 255, 67,0.9), inset -1px -1px 2px rgba(10, 255,
                      67,0.2)
                icon:
                  - color: "#0aff43"
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
      light:
        card:
          type: custom:button-card
          entity: light.ensuite_light
          show_name: false
          icon: mdi:lightbulb-on-outline
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(255, 243, 10,
                      0.15), rgba(255, 243, 10, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(255, 243, 10, 0.6), inset 1px 1px 2px
                      rgba(255, 243, 10,0.9), inset -1px -1px 2px rgba(255, 243,
                      10,0.2)
                icon:
                  - color: gold
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
      door:
        card:
          type: custom:button-card
          entity: binary_sensor.ensuite_door_sensor
          show_name: false
          icon: mdi:door-closed
          show_state: false
          tap_action:
            action: more-info
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(255, 80, 80,
                      0.15), rgba(255, 80, 80, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(255, 10, 75, 0.6), inset 1px 1px 2px
                      rgba(255, 10, 75,0.9), inset -1px -1px 2px rgba(255, 10,
                      75,0.2)
                icon:
                  - color: "#ff5050"
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255,255,255,0.12),
                  rgba(0,0,0,0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
  - type: vertical-stack
    cards:
      - type: conditional
        conditions:
          - entity: input_boolean.room_2_blinds_expanded
            state: "off"
        card:
          type: custom:button-card
          entity: binary_sensor.room_2_presence
          name: Room 2
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg\" \"i n temp automation light blinds\""
              - grid-template-columns: 48px 1fr 56px 36px 36px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[
                const isOn = entity.state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(102, 143, 255, 0.25), rgba(231, 110, 252, 0.15))'
                  : 'rgba(255, 255, 255, 0.02)';
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(102, 143, 255, 0.4)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(102, 143, 255, 0.5)';
                return `<div style="position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background:${background};border-radius:40px;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);box-shadow:${boxShadow};transition: all 0.4s ease;"></div>`;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#b0d7ff' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(99, 139, 255, 0.8), rgba(13, 24, 56, 0.5))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="padding-top: 8px; padding-bottom: 8px; display: flex; align-items: center; justify-content: flex-start;">
                    <div style="width: 36px; height: 36px; border-radius: 50%; background: ${circleBackground}; box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px rgba(197, 211, 252,0.5), inset -1px -1px 2px rgba(184, 202, 255,0.9); backdrop-filter: blur(6px); display: flex; align-items: center; justify-content: center; margin-left: 6px; z-index: 1;">
                      <ha-icon icon="mdi:bed" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            temp:
              card:
                type: custom:button-card
                entity: climate.room_2_thermostat
                show_name: false
                show_icon: false
                show_state: false
                tap_action:
                  action: more-info
                styles:
                  card:
                    - padding: 4px 10px 4px 0px
                    - border-radius: 999px
                    - font-weight: 600
                    - font-size: 0.7em
                    - background: |
                        [[[
                          const hvac = states['climate.room_2_thermostat']?.attributes?.hvac_action;
                          return hvac === 'heating'
                            ? 'radial-gradient(circle at 30% 30%, rgba(250, 74, 35, 0.15), rgba(250, 74, 35, 0.05))'
                            : 'rgba(255, 255, 255, 0.08)';
                        ]]]
                    - box-shadow: |
                        [[[
                          const hvac = states['climate.room_2_thermostat']?.attributes?.hvac_action;
                          return hvac === 'heating'
                            ? '0 0 10px 1px rgba(250, 74, 35, 0.6), inset 1px 1px 2px rgba(250, 74, 35,0.9), inset -1px -1px 2px rgba(250, 74, 35,0.2)'
                            : 'none';
                        ]]]
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                custom_fields:
                  value: |
                    [[[
                      const temp = parseFloat(states['sensor.room_2_current_temperature']?.state);
                      if (isNaN(temp)) return '';
                      const hvac = states['climate.room_2_thermostat']?.attributes?.hvac_action;
                      const iconColor = hvac === 'heating' ? '#fa4a23' : 'white';

                      let textColor = 'white';
                      if (temp < 20) textColor = '#63d8ff';
                      else if (temp > 24) textColor = '#fa783c';

                      return `
                        <div style="display: inline-flex; align-items: center; gap: 0px;">
                          <ha-icon icon="mdi:thermometer" style="width: 15px; height: 15px; color: ${iconColor};"></ha-icon>
                          <span style="color: ${textColor};">${temp.toFixed(1)}</span>
                        </div>
                      `;
                    ]]]
                  animate: |
                    [[[
                      if (states['input_boolean.room_2_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.15s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            automation:
              card:
                type: custom:button-card
                entity: input_boolean.room_2_automation
                icon: mdi:robot-outline
                show_name: false
                show_state: false
                tap_action:
                  action: toggle
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                            0.15), rgba(10, 255, 67, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px
                            2px rgba(10, 255, 67,0.9), inset -1px -1px 2px
                            rgba(10, 255, 67,0.2)
                      icon:
                        - color: "#0aff43"
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.room_2_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.1s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            light:
              card:
                type: custom:button-card
                entity: binary_sensor.room_2_any_light_on
                tap_action:
                  action: call-service
                  service: script.room_2_toggle_all_lights
                icon: mdi:lightbulb-on-outline
                show_name: false
                show_state: false
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(255, 243,
                            10, 0.15), rgba(255, 243, 10, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(255, 243, 10, 0.6), inset 1px 1px
                            2px rgba(255, 243, 10,0.9), inset -1px -1px 2px
                            rgba(255, 243, 10,0.2)
                      icon:
                        - color: gold
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.room_2_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.05s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            blinds:
              card:
                type: custom:button-card
                icon: |
                  [[[
                    const expanded = states['input_boolean.room_2_blinds_expanded']?.state === 'on';
                    if (expanded) return 'mdi:close';

                    const last = states['input_select.room_2_blinds_last_command']?.state;
                    if (last === 'open') return 'mdi:window-shutter-open';
                    if (last === 'close') return 'mdi:window-shutter';
                    if (last === 'my') return 'mdi:blinds-horizontal-closed';
                    if (last === 'stop') return 'mdi:window-shutter-alert';
                    return 'mdi:blinds-horizontal';
                  ]]]
                size: 45%
                show_state: false
                show_name: false
                tap_action:
                  action: call-service
                  service: input_boolean.toggle
                  service_data:
                    entity_id: input_boolean.room_2_blinds_expanded
                styles:
                  card:
                    - border-radius: 50%
                    - width: 32px
                    - height: 32px
                    - background: |
                        [[[
                          const last = states['input_select.room_2_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return 'radial-gradient(circle at 30% 30%, rgba(240, 138, 60, 0.15), rgba(240, 138, 60, 0.05))';
                          return 'linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0, 0, 0.08))';
                        ]]]
                    - box-shadow: |
                        [[[
                          const last = states['input_select.room_2_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return '0 0 10px 1px rgba(255, 98, 13, 0.6), inset 1px 1px 2px rgba(255, 98, 13, 0.9), inset -1px -1px 2px rgba(240, 138, 60, 0.2)';
                          return 'inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px rgba(0,0,0,0.1)';
                        ]]]
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                    - color: |
                        [[[
                          const expanded = states['input_boolean.room_2_blinds_expanded']?.state === 'on';
                          if (expanded) return 'white';

                          const last = states['input_select.room_2_blinds_last_command']?.state;
                          if (last === 'open') return '#f08a3c';
                          if (last === 'close') return 'black';
                          if (last === 'stop') return '#f08a3c';
                          if (last === 'my') return '#f08a3c';
                          return '#f0c000';
                        ]]]
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.room_2_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
      - type: conditional
        conditions:
          - entity: input_boolean.room_2_blinds_expanded
            state: "on"
        card:
          type: custom:button-card
          entity: binary_sensor.room_2_presence
          name: Room 2
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg bg\" \"i n up pause down my close\""
              - grid-template-columns: 48px 1fr 30px 30px 30px 30px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[
                const state = states['light.room2_light']?.state;
                const isOn = state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(102, 143, 255, 0.25), rgba(231, 110, 252, 0.15))'
                  : 'rgba(255, 255, 255, 0.02)';
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(102, 143, 255, 0.4)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(102, 143, 255, 0.5)';
                return `<div style="position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background:${background};border-radius:40px;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);box-shadow:${boxShadow};transition: all 0.4s ease;"></div>`;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#b0d7ff' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(99, 139, 255, 0.8), rgba(13, 24, 56, 0.5))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="padding-top: 8px; padding-bottom: 8px; display: flex; align-items: center; justify-content: flex-start;">
                    <div style="width: 36px; height: 36px; border-radius: 50%; background: ${circleBackground}; box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px rgba(197, 211, 252,0.5), inset -1px -1px 2px rgba(184, 202, 255,0.9); backdrop-filter: blur(6px); display: flex; align-items: center; justify-content: center; margin-left: 6px; z-index: 1;">
                      <ha-icon icon="mdi:bed" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            up:
              card:
                type: custom:button-card
                icon: mdi:arrow-up-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_2_shutter
                    command: open
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.2s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.6); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            pause:
              card:
                type: custom:button-card
                icon: mdi:pause
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_2_shutter
                    command: stop
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.15s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.5); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            down:
              card:
                type: custom:button-card
                icon: mdi:arrow-down-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_2_shutter
                    command: close
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.1s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.4); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            my:
              card:
                type: custom:button-card
                icon: mdi:star
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_2_shutter
                    command: my
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.05s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.3); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            close:
              card:
                type: custom:button-card
                icon: mdi:close-circle-outline
                tap_action:
                  action: call-service
                  service: script.room_2_blinds_boolean_toggle
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.2); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
  - type: vertical-stack
    cards:
      - type: conditional
        conditions:
          - entity: input_boolean.room_3_blinds_expanded
            state: "off"
        card:
          type: custom:button-card
          entity: binary_sensor.room_3_presence
          name: Room 3
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg bg\" \"i n temp automation light fan blinds\""
              - grid-template-columns: 48px 1fr 56px 36px 36px 36px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[
                const isOn = entity.state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(168, 127, 255, 0.25), rgba(255, 110, 240, 0.15))'
                  : 'rgba(255, 255, 255, 0.01)';
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(168, 127, 255, 0.7)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(168, 127, 255, 0.7)';
                return `
                  <div style="
                    position: absolute;
                    top: 0; left: 0; right: 0; bottom: 0;
                    z-index: -1;
                    background: ${background};
                    border-radius: 40px;
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    box-shadow: ${boxShadow};
                  "></div>
                `;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#dbc9ff' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(182, 145, 255, 0.8), rgba(46, 23, 92, 0.9))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="
                    padding-top: 8px;
                    padding-bottom: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                  ">
                    <div style="
                      width: 36px;
                      height: 36px;
                      border-radius: 50%;
                      background: ${circleBackground};
                      box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px
                            rgba(202, 185, 235,0.7), inset -1px -1px 2px rgba(202, 185, 235,0.9);
                      backdrop-filter: blur(6px);
                      -webkit-backdrop-filter: blur(6px);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin-left: 6px;
                      z-index: 1;
                    ">
                      <ha-icon icon="mdi:bed" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            temp:
              card:
                type: custom:button-card
                entity: climate.room_3_thermostat
                show_name: false
                show_icon: false
                show_state: false
                tap_action:
                  action: more-info
                styles:
                  card:
                    - padding: 4px 10px 4px 0px
                    - border-radius: 999px
                    - font-weight: 600
                    - font-size: 0.7em
                    - background: |
                        [[[
                          const hvac = states['climate.room_3_thermostat']?.attributes?.hvac_action;
                          return hvac === 'heating'
                            ? 'radial-gradient(circle at 30% 30%, rgba(250, 74, 35, 0.15), rgba(250, 74, 35, 0.05))'
                            : 'rgba(255, 255, 255, 0.08)';
                        ]]]
                    - box-shadow: |
                        [[[
                          const hvac = states['climate.room_3_thermostat']?.attributes?.hvac_action;
                          return hvac === 'heating'
                            ? '0 0 10px 1px rgba(250, 74, 35, 0.6), inset 1px 1px 2px rgba(250, 74, 35,0.9), inset -1px -1px 2px rgba(250, 74, 35,0.2)'
                            : 'none';
                        ]]]
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                custom_fields:
                  value: |
                    [[[
                      const temp = parseFloat(states['sensor.room_3_current_temperature']?.state);
                      if (isNaN(temp)) return '';
                      const hvac = states['climate.room_3_thermostat']?.attributes?.hvac_action;
                      const iconColor = hvac === 'heating' ? '#fa4a23' : 'white';

                      let textColor = 'white';
                      if (temp < 20) textColor = '#63d8ff';
                      else if (temp > 24) textColor = '#fa783c';

                      return `
                        <div style="display: inline-flex; align-items: center; gap: 0px;">
                          <ha-icon icon="mdi:thermometer" style="width: 15px; height: 15px; color: ${iconColor};"></ha-icon>
                          <span style="color: ${textColor};">${temp.toFixed(1)}</span>
                        </div>
                      `;
                    ]]]
                  animate: |
                    [[[
                      if (states['input_boolean.room_3_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.2s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            automation:
              card:
                type: custom:button-card
                entity: input_boolean.room_3_automation
                show_name: false
                icon: mdi:robot-outline
                show_state: false
                tap_action:
                  action: toggle
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                            0.15), rgba(10, 255, 67, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px
                            2px rgba(10, 255, 67,0.9), inset -1px -1px 2px
                            rgba(10, 255, 67,0.2)
                      icon:
                        - color: "#0aff43"
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.room_3_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.15s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            light:
              card:
                type: custom:button-card
                entity: light.room3_light
                tap_action:
                  action: toggle
                show_name: false
                icon: mdi:lightbulb-on-outline
                show_state: false
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(255, 223, 0,
                            0.15), rgba(255, 223, 0, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(255, 223, 0, 0.6), inset 1px 1px
                            2px rgba(255, 223, 0,0.9), inset -1px -1px 2px
                            rgba(255, 223, 0,0.2)
                      icon:
                        - color: gold
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.room_3_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.1s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            fan:
              card:
                type: custom:button-card
                entity: fan.room_3_fan
                show_name: false
                icon: mdi:fan
                show_state: false
                tap_action:
                  action: toggle
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(2, 242, 250,
                            0.15), rgba(2, 242, 250, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(2, 242, 250, 0.6), inset 1px 1px
                            2px rgba(2, 242, 250,0.9), inset -1px -1px 2px
                            rgba(2, 242, 250,0.2)
                      icon:
                        - color: "#02f2fa"
                        - animation: rotation 1s linear infinite
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.room_3_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.05s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
                extra_styles: |
                  @keyframes rotation {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                  }
            blinds:
              card:
                type: custom:button-card
                icon: |
                  [[[
                    const expanded = states['input_boolean.room_3_blinds_expanded']?.state === 'on';
                    if (expanded) return 'mdi:close';

                    const last = states['input_select.room_3_blinds_last_command']?.state;
                    if (last === 'open') return 'mdi:window-shutter-open';
                    if (last === 'close') return 'mdi:window-shutter';
                    if (last === 'my') return 'mdi:blinds-horizontal-closed';
                    if (last === 'stop') return 'mdi:window-shutter-alert';
                    return 'mdi:blinds-horizontal';
                  ]]]
                size: 45%
                show_state: false
                show_name: false
                tap_action:
                  action: call-service
                  service: input_boolean.toggle
                  service_data:
                    entity_id: input_boolean.room_3_blinds_expanded
                styles:
                  card:
                    - border-radius: 50%
                    - width: 32px
                    - height: 32px
                    - background: |
                        [[[
                          const last = states['input_select.room_3_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return 'radial-gradient(circle at 30% 30%, rgba(240, 138, 60, 0.15), rgba(240, 138, 60, 0.05))';
                          return 'linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0, 0, 0.08))';
                        ]]]
                    - box-shadow: |
                        [[[
                          const last = states['input_select.room_3_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return '0 0 10px 1px rgba(255, 98, 13, 0.6), inset 1px 1px 2px rgba(255, 98, 13, 0.9), inset -1px -1px 2px rgba(240, 138, 60, 0.2)';
                          return 'inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px rgba(0,0,0,0.1)';
                        ]]]
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                    - color: |
                        [[[
                          const expanded = states['input_boolean.room_3_blinds_expanded']?.state === 'on';
                          if (expanded) return 'white';

                          const last = states['input_select.room_3_blinds_last_command']?.state;
                          if (last === 'open') return '#f08a3c';
                          if (last === 'close') return 'black';
                          if (last === 'stop') return '#f08a3c';
                          if (last === 'my') return '#f08a3c';
                          return '#f0c000';
                        ]]]
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.room_3_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
      - type: conditional
        conditions:
          - entity: input_boolean.room_3_blinds_expanded
            state: "on"
        card:
          type: custom:button-card
          entity: binary_sensor.room_3_presence
          name: Room 3
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg bg\" \"i n up pause down my close\""
              - grid-template-columns: 48px 1fr 30px 30px 30px 30px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[
                const isOn = entity.state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(168, 127, 255, 0.25), rgba(255, 110, 240, 0.15))'
                  : 'rgba(255, 255, 255, 0.01)';
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(168, 127, 255, 0.7)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(168, 127, 255, 0.7)';
                return `
                  <div style="
                    position: absolute;
                    top: 0; left: 0; right: 0; bottom: 0;
                    z-index: -1;
                    background: ${background};
                    border-radius: 40px;
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    box-shadow: ${boxShadow};
                  "></div>
                `;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#dbc9ff' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(182, 145, 255, 0.8), rgba(46, 23, 92, 0.9))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="
                    padding-top: 8px;
                    padding-bottom: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                  ">
                    <div style="
                      width: 36px;
                      height: 36px;
                      border-radius: 50%;
                      background: ${circleBackground};
                      box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px
                            rgba(202, 185, 235,0.7), inset -1px -1px 2px rgba(202, 185, 235,0.9);
                      backdrop-filter: blur(6px);
                      -webkit-backdrop-filter: blur(6px);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin-left: 6px;
                      z-index: 1;
                    ">
                      <ha-icon icon="mdi:bed" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            up:
              card:
                type: custom:button-card
                icon: mdi:arrow-up-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_3_shutter
                    command: open
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.2s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.6); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            pause:
              card:
                type: custom:button-card
                icon: mdi:pause
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_3_shutter
                    command: stop
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.15s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.5); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            down:
              card:
                type: custom:button-card
                icon: mdi:arrow-down-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_3_shutter
                    command: close
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.1s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.4); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            my:
              card:
                type: custom:button-card
                icon: mdi:star
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_3_shutter
                    command: my
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.05s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.3); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            close:
              card:
                type: custom:button-card
                icon: mdi:close-circle-outline
                tap_action:
                  action: call-service
                  service: script.room_3_blinds_boolean_toggle
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.2); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
  - type: vertical-stack
    cards:
      - type: conditional
        conditions:
          - entity: input_boolean.room_4_blinds_expanded
            state: "off"
        card:
          type: custom:button-card
          entity: light.room_4_light
          name: Room 4
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg bg\" \"i n temp automation light fan blinds\""
              - grid-template-columns: 48px 1fr 56px 36px 36px 36px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[
                const isOn = entity.state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(0, 200, 0, 0.25), rgba(50, 0, 0, 0.15))'
                  : 'rgba(255, 255, 255, 0.01)';  // less opaque, more transparent
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(186, 245, 91, 0.4)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(186, 245, 91, 0.4)';
                return `
                  <div style="
                    position: absolute;
                    top: 0; left: 0; right: 0; bottom: 0;
                    z-index: -1;
                    background: ${background};
                    border-radius: 40px;
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    box-shadow: ${boxShadow};
                  "></div>
                `;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#e9faaa' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(92, 138, 7, 0.9), rgba(255, 89, 0, 0.1))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="
                    padding-top: 8px;
                    padding-bottom: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                  ">
                    <div style="
                      width: 36px;
                      height: 36px;
                      border-radius: 50%;
                      background: ${circleBackground};
                      box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px
                            rgba(186, 245, 91,0.4), inset -1px -1px 2px rgba(186, 245, 91,0.9);
                      backdrop-filter: blur(6px);
                      -webkit-backdrop-filter: blur(6px);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin-left: 6px;
                      z-index: 1;
                    ">
                      <ha-icon icon="mdi:bed" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            temp:
              card:
                type: custom:button-card
                entity: climate.room_4_thermostat
                show_name: false
                show_icon: false
                show_state: false
                tap_action:
                  action: more-info
                styles:
                  card:
                    - padding: 4px 10px 4px 0px
                    - border-radius: 999px
                    - display: block
                    - font-weight: 600
                    - font-size: 0.7em
                    - text-align: center
                    - overflow: visible
                    - background: |
                        [[[
                          const hvac = states['climate.room_4_thermostat']?.attributes?.hvac_action;
                          return hvac === 'heating'
                            ? 'radial-gradient(circle at 30% 30%, rgba(250, 74, 35, 0.15), rgba(250, 74, 35, 0.05))'
                            : 'rgba(255, 255, 255, 0.08)';
                        ]]]
                    - box-shadow: |
                        [[[
                          const hvac = states['climate.room_4_thermostat']?.attributes?.hvac_action;
                          return hvac === 'heating'
                            ? '0 0 10px 1px rgba(250, 74, 35, 0.6), inset 1px 1px 2px rgba(250, 74, 35,0.9), inset -1px -1px 2px rgba(250, 74, 35,0.2)'
                            : 'none';
                        ]]]
                custom_fields:
                  value: |
                    [[[
                      const temp = parseFloat(states['sensor.room_4_current_temperature']?.state);
                      if (isNaN(temp)) return '';
                      const hvac = states['climate.room_4_thermostat']?.attributes?.hvac_action;
                      const iconColor = hvac === 'heating' ? '#fa4a23' : 'white';

                      let textColor = 'white';
                      if (temp < 20) textColor = '#63d8ff';    // Blue
                      else if (temp > 24) textColor = '#fa783c'; // Red

                      return `
                        <div style="
                          display: inline-flex;
                          align-items: center;
                          justify-content: center;
                          gap: 0px;
                          line-height: 1;
                          transform: translateX(1px);
                        ">
                          <ha-icon icon="mdi:thermometer" style="width: 15px; height: 15px; color: ${iconColor};"></ha-icon>
                          <span style="color: ${textColor};">${temp.toFixed(1)}</span>
                        </div>
                      `;
                    ]]]
                  animate: |
                    [[[
                      if (states['input_boolean.room_4_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.2s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            automation:
              card:
                type: custom:button-card
                entity: input_boolean.room_4_automation
                show_name: false
                icon: mdi:robot-outline
                show_state: false
                tap_action:
                  action: toggle
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                            0.15), rgba(10, 255, 67, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px
                            2px rgba(10, 255, 67,0.9), inset -1px -1px 2px
                            rgba(10, 255, 67,0.2)
                      icon:
                        - color: "#0aff43"
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.room_4_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.15s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            light:
              card:
                type: custom:button-card
                entity: light.room_4_light
                tap_action:
                  action: toggle
                show_name: false
                icon: mdi:lightbulb-on-outline
                show_state: false
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(255, 243,
                            10, 0.15), rgba(255, 243, 10, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(255, 243, 10, 0.6), inset 1px 1px
                            2px rgba(255, 243, 10,0.9), inset -1px -1px 2px
                            rgba(255, 243, 10,0.2)
                      icon:
                        - color: gold
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.room_4_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.1s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            fan:
              card:
                type: custom:button-card
                entity: fan.room_3_fan
                show_name: false
                icon: mdi:fan
                show_state: false
                tap_action:
                  action: toggle
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(2, 242, 250,
                            0.15), rgba(2, 242, 250, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(2, 242, 250, 0.6), inset 1px 1px
                            2px rgba(2, 242, 250,0.9), inset -1px -1px 2px
                            rgba(2, 242, 250,0.2)
                      icon:
                        - color: "#02f2fa"
                        - animation: rotation 1s linear infinite
                  - value: "off"
                    styles:
                      icon:
                        - color: black !important;
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.room_4_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.05s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
                extra_styles: |
                  @keyframes rotation {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                  }
            blinds:
              card:
                type: custom:button-card
                icon: |
                  [[[
                    const expanded = states['input_boolean.room_4_blinds_expanded']?.state === 'on';
                    if (expanded) return 'mdi:close';

                    const last = states['input_select.room_4_blinds_last_command']?.state;
                    if (last === 'open') return 'mdi:window-shutter-open';
                    if (last === 'close') return 'mdi:window-shutter';
                    if (last === 'my') return 'mdi:blinds-horizontal-closed';
                    if (last === 'stop') return 'mdi:window-shutter-alert';
                    return 'mdi:blinds-horizontal';
                  ]]]
                size: 45%
                show_state: false
                show_name: false
                tap_action:
                  action: call-service
                  service: input_boolean.toggle
                  service_data:
                    entity_id: input_boolean.room_4_blinds_expanded
                styles:
                  card:
                    - border-radius: 50%
                    - width: 32px
                    - height: 32px
                    - background: |
                        [[[
                          const last = states['input_select.room_4_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return 'radial-gradient(circle at 30% 30%, rgba(240, 138, 60, 0.15), rgba(240, 138, 60, 0.05))';
                          return 'linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0, 0, 0.08))';
                        ]]]
                    - box-shadow: |
                        [[[
                          const last = states['input_select.room_4_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return '0 0 10px 1px rgba(255, 98, 13, 0.6), inset 1px 1px 2px rgba(255, 98, 13, 0.9), inset -1px -1px 2px rgba(240, 138, 60, 0.2)';
                          return 'inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px rgba(0,0,0,0.1)';
                        ]]]
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                    - color: |
                        [[[
                          const expanded = states['input_boolean.room_4_blinds_expanded']?.state === 'on';
                          if (expanded) return 'white';

                          const last = states['input_select.room_4_blinds_last_command']?.state;
                          if (last === 'open') return '#f08a3c';
                          if (last === 'close') return 'black';
                          if (last === 'stop') return '#f08a3c';
                          if (last === 'my') return '#f08a3c';
                          return '#f0c000';
                        ]]]
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.room_4_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
          extra_styles: |
            @keyframes pulse {
              0% { box-shadow: 0 0 0px rgba(255,136,77,0.6); }
              50% { box-shadow: 0 0 12px rgba(255,136,77,1); }
              100% { box-shadow: 0 0 0px rgba(255,136,77,0.6); }
            }
      - type: conditional
        conditions:
          - entity: input_boolean.room_4_blinds_expanded
            state: "on"
        card:
          type: custom:button-card
          entity: light.room_4_light
          name: Room 4
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg bg\" \"i n up pause down my close\""
              - grid-template-columns: 48px 1fr 30px 30px 30px 30px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[
                const isOn = entity.state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(0, 200, 0, 0.25), rgba(50, 0, 0, 0.15))'
                  : 'rgba(255, 255, 255, 0.01)';  // less opaque, more transparent
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(186, 245, 91, 0.4)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(186, 245, 91, 0.4)';
                return `
                  <div style="
                    position: absolute;
                    top: 0; left: 0; right: 0; bottom: 0;
                    z-index: -1;
                    background: ${background};
                    border-radius: 40px;
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    box-shadow: ${boxShadow};
                  "></div>
                `;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#e9faaa' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(92, 138, 7, 0.9), rgba(255, 89, 0, 0.1))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="
                    padding-top: 8px;
                    padding-bottom: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                  ">
                    <div style="
                      width: 36px;
                      height: 36px;
                      border-radius: 50%;
                      background: ${circleBackground};
                      box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px
                            rgba(186, 245, 91,0.4), inset -1px -1px 2px rgba(186, 245, 91,0.9);
                      backdrop-filter: blur(6px);
                      -webkit-backdrop-filter: blur(6px);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      margin-left: 6px;
                      z-index: 1;
                    ">
                      <ha-icon icon="mdi:bed" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            up:
              card:
                type: custom:button-card
                icon: mdi:arrow-up-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_4_shutter
                    command: open
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.2s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.6); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            pause:
              card:
                type: custom:button-card
                icon: mdi:pause
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_4_shutter
                    command: stop
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.15s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.5); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            down:
              card:
                type: custom:button-card
                icon: mdi:arrow-down-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_4_shutter
                    command: close
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.1s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.4); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            my:
              card:
                type: custom:button-card
                icon: mdi:star
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.room_4_shutter
                    command: my
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.05s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.3); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            close:
              card:
                type: custom:button-card
                icon: mdi:close-circle-outline
                tap_action:
                  action: call-service
                  service: script.room_4_blinds_boolean_toggle
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.2); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
  - type: vertical-stack
    cards:
      - type: conditional
        conditions:
          - entity: input_boolean.study_blinds_expanded
            state: "off"
        card:
          type: custom:button-card
          entity: binary_sensor.study_fp2_presence_sensor_2
          name: Study
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg bg\" \"i n temp automation light fan blinds\""
              - grid-template-columns: 48px 1fr 56px 36px 36px 36px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[
                const isOn = entity.state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(255, 174, 127, 0.25), rgba(186, 110, 252, 0.15))'
                  : 'rgba(255, 255, 255, 0.01)';
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(255, 174, 127, 0.4)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(255, 174, 127, 0.4)';
                return `
                  <div style="
                    position: absolute;
                    top: 0; left: 0; right: 0; bottom: 0;
                    z-index: -1;
                    background: ${background};
                    border-radius: 40px;
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    box-shadow: ${boxShadow};
                  "></div>
                `;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#ffa76b' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(255, 159, 100, 0.8), rgba(51, 27, 12, 0.5))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="padding-top: 8px; padding-bottom: 8px; display: flex; align-items: center; justify-content: flex-start;">
                    <div style="width: 36px; height: 36px; border-radius: 50%; background: ${circleBackground}; box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px rgba(255, 194, 156,0.5), inset -1px -1px 2px rgba(255, 194, 156,0.9); backdrop-filter: blur(6px); display: flex; align-items: center; justify-content: center; margin-left: 6px; z-index: 1;">
                      <ha-icon icon="mdi:monitor" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            temp:
              card:
                type: custom:button-card
                entity: climate.study_thermostat
                show_name: false
                show_icon: false
                show_state: false
                tap_action:
                  action: more-info
                styles:
                  card:
                    - padding: 4px 10px 4px 0px
                    - border-radius: 999px
                    - font-weight: 600
                    - font-size: 0.7em
                    - background: |
                        [[[
                          const hvac = states['climate.study_thermostat']?.attributes?.hvac_action;
                          return hvac === 'heating'
                            ? 'radial-gradient(circle at 30% 30%, rgba(250, 74, 35, 0.15), rgba(250, 74, 35, 0.05))'
                            : 'rgba(255, 255, 255, 0.08)';
                        ]]]
                    - box-shadow: |
                        [[[
                          const hvac = states['climate.study_thermostat']?.attributes?.hvac_action;
                          return hvac === 'heating'
                            ? '0 0 10px 1px rgba(250, 74, 35, 0.6), inset 1px 1px 2px rgba(250, 74, 35,0.9), inset -1px -1px 2px rgba(250, 74, 35,0.2)'
                            : 'none';
                        ]]]
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                custom_fields:
                  value: |
                    [[[
                      const temp = parseFloat(states['sensor.study_current_temperature']?.state);
                      if (isNaN(temp)) return '';
                      const hvac = states['climate.study_thermostat']?.attributes?.hvac_action;
                      const iconColor = hvac === 'heating' ? '#fa4a23' : 'white';

                      let textColor = 'white';
                      if (temp < 20) textColor = '#63d8ff';
                      else if (temp > 24) textColor = '#fa783c';

                      return `
                        <div style="display: inline-flex; align-items: center; gap: 0px;">
                          <ha-icon icon="mdi:thermometer" style="width: 15px; height: 15px; color: ${iconColor};"></ha-icon>
                          <span style="color: ${textColor};">${temp.toFixed(1)}</span>
                        </div>
                      `;
                    ]]]
                  animate: |
                    [[[
                      if (states['input_boolean.study_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.2s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            automation:
              card:
                type: custom:button-card
                entity: input_boolean.study_automation
                show_name: false
                icon: mdi:robot-outline
                show_state: false
                tap_action:
                  action: toggle
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                            0.15), rgba(10, 255, 67, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px
                            2px rgba(10, 255, 67,0.9), inset -1px -1px 2px
                            rgba(10, 255, 67,0.2)
                      icon:
                        - color: "#0aff43"
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.study_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.15s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            light:
              card:
                type: custom:button-card
                entity: binary_sensor.study_any_light_on
                tap_action:
                  action: call-service
                  service: script.study_toggle_all_lights
                show_name: false
                icon: mdi:lightbulb-on-outline
                show_state: false
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(255, 223, 0,
                            0.15), rgba(255, 223, 0, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(255, 223, 0, 0.6), inset 1px 1px
                            2px rgba(255, 223, 0,0.9), inset -1px -1px 2px
                            rgba(255, 223, 0,0.2)
                      icon:
                        - color: gold
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.study_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.1s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
            fan:
              card:
                type: custom:button-card
                entity: fan.study_fan
                show_name: false
                icon: mdi:fan
                show_state: false
                tap_action:
                  action: toggle
                state:
                  - value: "on"
                    styles:
                      card:
                        - background: >-
                            radial-gradient(circle at 30% 30%, rgba(2, 242, 250,
                            0.15), rgba(2, 242, 250, 0.05))
                        - box-shadow: >-
                            0 0 10px 1px rgba(2, 242, 250, 0.6), inset 1px 1px
                            2px rgba(2, 242, 250,0.9), inset -1px -1px 2px
                            rgba(2, 242, 250,0.2)
                      icon:
                        - color: "#02f2fa"
                        - animation: rotation 1s linear infinite
                  - value: "off"
                    styles:
                      icon:
                        - color: black
                styles:
                  card:
                    - background: >-
                        linear-gradient(145deg, rgba(255, 255, 255, 0.12),
                        rgba(0, 0, 0, 0.08))
                    - border-radius: 50%
                    - box-shadow: >-
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - padding: 0
                    - width: 32px
                    - height: 32px
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.study_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            animation-delay: 0.05s;
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
                extra_styles: |
                  @keyframes rotation {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                  }
            blinds:
              card:
                type: custom:button-card
                icon: |
                  [[[
                    const expanded = states['input_boolean.study_blinds_expanded']?.state === 'on';
                    if (expanded) return 'mdi:close';

                    const last = states['input_select.study_blinds_last_command']?.state;
                    if (last === 'open') return 'mdi:window-shutter-open';
                    if (last === 'close') return 'mdi:window-shutter';
                    if (last === 'my') return 'mdi:blinds-horizontal-closed';
                    if (last === 'stop') return 'mdi:window-shutter-alert';
                    return 'mdi:blinds-horizontal';
                  ]]]
                size: 45%
                show_state: false
                show_name: false
                tap_action:
                  action: call-service
                  service: input_boolean.toggle
                  service_data:
                    entity_id: input_boolean.study_blinds_expanded
                styles:
                  card:
                    - border-radius: 50%
                    - width: 32px
                    - height: 32px
                    - background: |
                        [[[
                          const last = states['input_select.study_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return 'radial-gradient(circle at 30% 30%, rgba(240, 138, 60, 0.15), rgba(240, 138, 60, 0.05))';
                          return 'linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0, 0, 0.08))';
                        ]]]
                    - box-shadow: |
                        [[[
                          const last = states['input_select.study_blinds_last_command']?.state;
                          if (last === 'open' || last === 'stop' || last === 'my')
                            return '0 0 10px 1px rgba(255, 98, 13, 0.6), inset 1px 1px 2px rgba(255, 98, 13, 0.9), inset -1px -1px 2px rgba(240, 138, 60, 0.2)';
                          return 'inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px rgba(0,0,0,0.1)';
                        ]]]
                  custom_fields:
                    animate:
                      - display: block
                      - height: 0
                      - overflow: hidden
                      - visibility: hidden
                  icon:
                    - font-size: 1.3em
                    - color: |
                        [[[
                          const expanded = states['input_boolean.study_blinds_expanded']?.state === 'on';
                          if (expanded) return 'white';

                          const last = states['input_select.study_blinds_last_command']?.state;
                          if (last === 'open') return '#f08a3c';
                          if (last === 'close') return 'black';
                          if (last === 'stop') return '#f08a3c';
                          if (last === 'my') return '#f08a3c';
                          return '#f0c000';
                        ]]]
                custom_fields:
                  animate: |
                    [[[
                      if (states['input_boolean.study_blinds_collapsed']?.state === 'on') {
                        return `<style>
                          @keyframes zoomReveal {
                            from { opacity: 0; transform: scale(0.7); }
                            to { opacity: 1; transform: scale(1); }
                          }
                          ha-card {
                            animation: zoomReveal 0.3s ease-out forwards;
                            
                            opacity: 0;
                          }
                        </style>`;
                      }
                      return '';
                    ]]]
      - type: conditional
        conditions:
          - entity: input_boolean.study_blinds_expanded
            state: "on"
        card:
          type: custom:button-card
          entity: binary_sensor.study_fp2_presence_sensor_2
          name: Study
          show_state: false
          show_name: true
          layout: custom
          styles:
            card:
              - position: relative
              - height: 48px
              - margin: 0
              - padding: 0 2px
              - display: flex
              - align-items: center
              - justify-content: space-between
              - border-radius: 40px
              - overflow: visible
              - transition: all 0.3s ease-in-out
              - background: none
              - box-shadow: none
            grid:
              - grid-template-areas: "\"bg bg bg bg bg bg bg\" \"i n up pause down my close\""
              - grid-template-columns: 48px 1fr 30px 30px 30px 30px 36px
              - column-gap: 4px
            name:
              - justify-self: start
              - font-size: 0.9em
              - font-weight: bold
            icon:
              - display: none
          custom_fields:
            bg: |
              [[[
                const isOn = entity.state === 'on';
                const background = isOn
                  ? 'linear-gradient(135deg, rgba(255, 174, 127, 0.25), rgba(186, 110, 252, 0.15))'
                  : 'rgba(255, 255, 255, 0.01)';
                const boxShadow = isOn
                  ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(255, 174, 127, 0.4)'
                  : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(255, 174, 127, 0.4)';
                return `
                  <div style="
                    position: absolute;
                    top: 0; left: 0; right: 0; bottom: 0;
                    z-index: -1;
                    background: ${background};
                    border-radius: 40px;
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    box-shadow: ${boxShadow};
                  "></div>
                `;
              ]]]
            i: |
              [[[
                const isPresent = entity.state === 'on';
                const iconColor = isPresent ? '#ffa76b' : 'white';
                const circleBackground = isPresent
                  ? 'linear-gradient(145deg, rgba(255, 159, 100, 0.8), rgba(51, 27, 12, 0.5))'
                  : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
                return `
                  <div style="padding-top: 8px; padding-bottom: 8px; display: flex; align-items: center; justify-content: flex-start;">
                    <div style="width: 36px; height: 36px; border-radius: 50%; background: ${circleBackground}; box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px rgba(255, 194, 156,0.5), inset -1px -1px 2px rgba(255, 194, 156,0.9); backdrop-filter: blur(6px); display: flex; align-items: center; justify-content: center; margin-left: 6px; z-index: 1;">
                      <ha-icon icon="mdi:monitor" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon>
                    </div>
                  </div>`;
              ]]]
            up:
              card:
                type: custom:button-card
                icon: mdi:arrow-up-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.study_shutter
                    command: open
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.2s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.6); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            pause:
              card:
                type: custom:button-card
                icon: mdi:pause
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.study_shutter
                    command: stop
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.15s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.5); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            down:
              card:
                type: custom:button-card
                icon: mdi:arrow-down-bold
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.study_shutter
                    command: close
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.1s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.4); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            my:
              card:
                type: custom:button-card
                icon: mdi:star
                tap_action:
                  action: call-service
                  service: script.control_blinds
                  data:
                    cover_entity: cover.study_shutter
                    command: my
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - animation-delay: 0.05s
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.3); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
            close:
              card:
                type: custom:button-card
                icon: mdi:close-circle-outline
                tap_action:
                  action: call-service
                  service: script.study_blinds_boolean_toggle
                styles:
                  card:
                    - border-radius: 50%
                    - width: 30px
                    - height: 30px
                    - background: rgba(255,255,255,0.05)
                    - box-shadow: >
                        inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px
                        2px rgba(0,0,0,0.1)
                    - animation: zoomReveal 0.5s ease-out forwards
                    - opacity: 0
                    - transform: scale(1.1)
                  icon:
                    - color: white
                    - font-size: 1.2em
                custom_fields:
                  animate: |
                    [[[
                      return `<style>
                        @keyframes zoomReveal {
                          from { opacity: 0; transform: scale(1.2); }
                          to { opacity: 1; transform: scale(1); }
                        }
                      </style>`;
                    ]]]
  - type: custom:button-card
    entity: binary_sensor.washroom_presence
    name: Washroom
    show_state: false
    show_name: true
    layout: custom
    styles:
      card:
        - position: relative
        - height: 48px
        - margin: 0
        - padding: 0 2px
        - display: flex
        - align-items: center
        - justify-content: space-between
        - border-radius: 40px
        - overflow: visible
      grid:
        - grid-template-areas: "\"bg bg bg bg bg bg\" \"i n temp automation light door\""
        - grid-template-columns: 48px 1fr 56px 36px 36px 36px
        - column-gap: 4px
      name:
        - justify-self: start
        - font-size: 0.9em
        - font-weight: bold
      icon:
        - display: none
    custom_fields:
      bg: |
        [[[ const isOn = entity && entity.state === 'on';
            const background = isOn ? 'linear-gradient(135deg, rgba(255, 135, 80, 0.25), rgba(80, 0, 0, 0.15))' : 'rgba(255, 255, 255, 0.01)';
            const boxShadow = isOn ? '0 0 2px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(230, 130, 120, 0.4)' : '0 0 4px 1px rgba(0, 0, 0, 0.1), inset 1px 1px 0.5px rgba(255, 255, 255, 0.2), inset -1px -1px 0.5px rgba(230, 130, 120, 0.4)';
            return `<div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: -1; background: ${background}; border-radius: 40px; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); box-shadow: ${boxShadow};"></div>`;
        ]]]
      i: |
        [[[ const isPresent = entity && entity.state === 'on';
            const iconColor = isPresent ? '#f79143' : 'white';
            const circleBackground = isPresent ? 'linear-gradient(145deg, rgba(247, 112, 67, 0.9), rgba(0, 0, 0, 0.6))' : 'linear-gradient(145deg, rgba(0, 0, 0, 0.05), rgba(0, 0, 0, 0.2))';
            return `<div style="padding-top: 8px; padding-bottom: 8px; display: flex; align-items: center; justify-content: flex-start;"><div style="width: 36px; height: 36px; border-radius: 50%; background: ${circleBackground}; box-shadow: 0 3px 6px rgba(0,0,0,0.25), inset 1px 1px 2px rgba(230, 130, 120, 0.4), inset -1px -1px 2px rgba(230, 130, 120, 0.9); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); display: flex; align-items: center; justify-content: center; margin-left: 6px; z-index: 1;"><ha-icon icon="mdi:shower" style="color: ${iconColor}; width: 22px; height: 22px;"></ha-icon></div></div>`;
        ]]]
      temp:
        card:
          type: custom:button-card
          entity: climate.washroom_thermostat
          show_name: false
          show_icon: false
          show_state: false
          tap_action:
            action: more-info
          styles:
            card:
              - padding: 4px 10px 4px 0px
              - border-radius: 999px
              - display: block
              - font-weight: 600
              - font-size: 0.7em
              - text-align: center
              - overflow: visible
              - background: >
                  [[[ const hvac =
                  states['climate.washroom_thermostat']?.attributes?.hvac_action;
                  return hvac === 'heating' ? 'radial-gradient(circle at 30%
                  30%, rgba(250, 74, 35, 0.15), rgba(250, 74, 35, 0.05))' :
                  'rgba(255, 255, 255, 0.08)'; ]]]
              - box-shadow: >
                  [[[ const hvac =
                  states['climate.washroom_thermostat']?.attributes?.hvac_action;
                  return hvac === 'heating' ? '0 0 10px 1px rgba(250, 74, 35,
                  0.6), inset 1px 1px 2px rgba(250, 74, 35,0.9), inset -1px -1px
                  2px rgba(250, 74, 35,0.2)' : 'none'; ]]]
          custom_fields:
            value: >
              [[[ const temp =
              parseFloat(states['sensor.washroom_current_temperature']?.state);
              if (isNaN(temp)) return ''; const hvac =
              states['climate.washroom_thermostat']?.attributes?.hvac_action;
              const iconColor = hvac === 'heating' ? '#fa4a23' : 'white'; let
              textColor = 'white'; if (temp < 20) textColor = '#63d8ff'; else if
              (temp > 24) textColor = '#fa783c'; return `<div style="display:
              inline-flex; align-items: center; justify-content: center; gap:
              0px; line-height: 1; transform: translateX(1px);"><ha-icon
              icon="mdi:thermometer" style="width: 15px; height: 15px; color:
              ${iconColor};"></ha-icon><span style="color:
              ${textColor};">${temp.toFixed(1)}</span></div>`; ]]]
      automation:
        card:
          type: custom:button-card
          entity: input_boolean.washroom_automation
          show_name: false
          icon: mdi:robot-outline
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(10, 255, 67,
                      0.15), rgba(10, 255, 67, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(10, 255, 67, 0.6), inset 1px 1px 2px
                      rgba(10, 255, 67,0.9), inset -1px -1px 2px rgba(10, 255,
                      67,0.2)
                icon:
                  - color: "#0aff43"
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
      light:
        card:
          type: custom:button-card
          entity: light.washroom_light
          show_name: false
          icon: mdi:lightbulb-on-outline
          show_state: false
          tap_action:
            action: toggle
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(255, 243, 10,
                      0.15), rgba(255, 243, 10, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(255, 243, 10, 0.6), inset 1px 1px 2px
                      rgba(255, 243, 10,0.9), inset -1px -1px 2px rgba(255, 243,
                      10,0.2)
                icon:
                  - color: gold
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(0, 0,
                  0, 0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
      door:
        card:
          type: custom:button-card
          entity: binary_sensor.contact_sensor
          show_name: false
          icon: mdi:door-closed
          show_state: false
          tap_action:
            action: more-info
          state:
            - value: "on"
              styles:
                card:
                  - background: >-
                      radial-gradient(circle at 30% 30%, rgba(255, 80, 80,
                      0.15), rgba(255, 80, 80, 0.05))
                  - box-shadow: >-
                      0 0 10px 1px rgba(255, 10, 75, 0.6), inset 1px 1px 2px
                      rgba(255, 10, 75,0.9), inset -1px -1px 2px rgba(255, 10,
                      75,0.2)
                icon:
                  - color: "#ff5050"
            - value: "off"
              styles:
                icon:
                  - color: black
          styles:
            card:
              - background: >-
                  linear-gradient(145deg, rgba(255,255,255,0.12),
                  rgba(0,0,0,0.08))
              - border-radius: 50%
              - box-shadow: >-
                  inset 1px 1px 2px rgba(255,255,255,0.2), inset -1px -1px 2px
                  rgba(0,0,0,0.1)
              - padding: 0
              - width: 32px
              - height: 32px
            icon:
              - font-size: 1.3em
